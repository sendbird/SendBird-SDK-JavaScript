/**
 * Copyright (c) 2016 SendBird DBA (Smile Family, Inc.)
 * SendBird JavaScript SDK v3.0.60
 */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.SendBird=n():e.SendBird=n()}("undefined"!=typeof self?self:this,function(){function e(){this.oldIE=!0,this.boundary="--------FormData"+Math.random(),this._fields=[]}var n,t=!1,r="wss://ws.sendbird.com",i="https://api.sendbird.com";try{n=window.console||{log:function(){}}}catch(e){n={log:function(){}}}var a="undefined";try{a=navigator.userAgent.replace(/,/g,".")}catch(e){a="undefined"}var s,o="JS,"+a+",3.0.60,",l=function(){try{if(document&&9===document.documentMode)return!0}catch(e){return!1}return!1}(),u=function(){try{if(document&&document.documentMode<=8)return!0}catch(e){return!1}return!1}();if(l||u)"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var n=0;n<this.length;n++)e.apply(this,[this[n],n,this])}),e.prototype.append=function(e,n){this._fields.push([e,n])},e.prototype.toString=function(){var e=this.boundary,n="";return this._fields.forEach(function(t){if(n+="--"+e+"\r\n",t[1].name){var r=t[1];n+='Content-Disposition: form-data; name="'+t[0]+'"; filename="'+r.name+'"\r\n',n+="Content-Transfer-Encoding: base64\r\n",n+="Content-Type: "+r.type+"\r\n\r\n",n+=r.base64+"\r\n"}else n+='Content-Disposition: form-data; name="'+t[0]+'";\r\n\r\n',n+=t[1]+"\r\n"}),n+="--"+e+"--"},s=e;else if("undefined"==typeof window&&"undefined"==typeof FormData)try{s=require("form-data")}catch(e){}var c=function(e,n,t){if(t&&"function"==typeof t)if(e){var r=null;try{r=JSON.parse(e.response)}catch(e){}var i=r?r.message:null,a=r?r.code:null;t(n,new _(i,a))}else t(n,null)},d=function(e){for(var n in e)if(e.hasOwnProperty(n))return!1;return Array.isArray(e)?JSON.stringify(e)===JSON.stringify([]):JSON.stringify(e)===JSON.stringify({})},h=function(e){try{if("number"==typeof e)return!0;if("string"==typeof e){return/^\d+$/.test(e)}}catch(e){return t&&n.error(e),!1}},I=function(){var e=function(){};return function(n,t){e.prototype=new n,t.prototype=new e,t["super"]=n.prototype,t.prototype.constructor=t}}(),_=function(e,n){return this.name="SendBirdException",this.code=n||0,this.message=e,this};I(Error,_);var p={MessageTypeFilter:{ALL:0,USER:1,FILE:2,ADMIN:3}},E=function(e){return Object.keys(e).forEach(function(n){null!==e[n]&&"undefined"!=typeof e[n]&&"object"==typeof e[n]&&(e[n]=E(e[n]))}),Object.freeze(e)},f=function(e){return JSON.parse(JSON.stringify(e))},A=function(){var e,l={};try{e="undefined"==typeof window?require("xhr2"):null}catch(n){e=null}if(e)try{var A=require("agentkeepalive"),g=require("agentkeepalive").HttpsAgent,m=new A({keepAlive:!0,timeout:6e4,keepAliveTimeout:6e4});l.httpAgent=m;var v=new g({keepAlive:!0,timeout:6e4,keepAliveTimeout:6e4});l.httpsAgent=v}catch(e){}var N=function(){var n;return e?(n=new e,n.nodejsSet(l)):n=new XMLHttpRequest,n},C=function(e,r,i,a,o){var l=N();l.open(i,e),l.onload=function(){if(l.status>=200&&l.status<400){var e=!1,n=null;try{n=JSON.parse(l.responseText)}catch(n){e=!0}e?c(new _("Request failed.",j.REQUEST_FAILED),null,o):c(null,n,o)}else c({status:l.status,statusText:l.statusText,response:l.responseText},null,o)},l.onerror=function(){c({status:404,statusText:"There was a connection error",response:JSON.stringify({message:"There was a connection error",code:j.NETWORK_ERROR})},null,o)};try{for(var u in a)l.setRequestHeader(u,a[u]?a[u]:"sendbird")}catch(e){}try{switch(i){case"get":case"GET":l.send();break;default:"undefined"!=typeof FormData&&FormData&&r instanceof FormData||void 0!==s&&s&&r instanceof s?r.oldIE?(l.setRequestHeader("Content-Type","multipart/form-data; boundary="+r.boundary),l.send(r.toString())):l.send(r):(l.setRequestHeader("Content-Type","application/json; charset=utf-8"),l.send(JSON.stringify(r)))}}catch(e){t&&n.log("request.send() fail: ",e)}},R=!1,U=function(e,n,t){t&&"function"==typeof t&&(void 0===n&&(n=null),void 0===e&&(e=null),R?t(n,e):t(e,n))},S="",y=0,P=0,T=function(e){this.isOpenChannel=function(){return this.channelType===M.CHANNEL_TYPE_OPEN},this.isGroupChannel=function(){return this.channelType===M.CHANNEL_TYPE_GROUP},this.isUserMessage=function(){return this.messageType===T.MESSAGE_TYPE_USER},this.isAdminMessage=function(){return this.messageType===T.MESSAGE_TYPE_ADMIN},this.isFileMessage=function(){return this.messageType===T.MESSAGE_TYPE_FILE},this._update=function(e){this.messageId=e.hasOwnProperty("msg_id")?parseInt(e.msg_id):0,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):M.CHANNEL_TYPE_GROUP;var n=this;if(n.mentionedUsers=[],e.hasOwnProperty("mentioned_users")){e.mentioned_users.forEach(function(e){var t=new G(e);n.mentionedUsers.push(t)})}},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));return e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender),E(e)},this.messageType=T.MESSAGE_TYPE_BASE,e&&this._update(e)};T.build=function(e,n){if(!e)return null;var t,r,i,a,s,o,l,u,c;switch(e.type){case"MESG":return t=new G(e.user),r=parseInt(e.message_id),i=String(e.message),a=String(e.data),s=parseInt(e.created_at),o=parseInt(e.updated_at),l=e.hasOwnProperty("custom_type")?String(e.custom_type):"",u=e.hasOwnProperty("translations")?e.translations:{},c=e.mentioned_users,new O(O.build("",r,t,n,i,a,l,u,s,o,c));case"FILE":t=new G(e.user),r=parseInt(e.message_id),i=String(e.message),s=parseInt(e.created_at),o=parseInt(e.updated_at),l=e.hasOwnProperty("custom_type")?String(e.custom_type):"",c=e.mentioned_users;var d=e.file,h=String(d.url),I=String(d.name),_=String(d.type),p=parseInt(d.size)||0;a=String(d.data);var E=e.hasOwnProperty("thumbnails")?e.thumbnails:[],f=!!e.hasOwnProperty("require_auth")&&e.require_auth;return new D(D.build("",r,t,n,h,I,_,p,a,l,s,E,f,o,c));case"BRDM":case"ADMM":return r=parseInt(e.message_id),i=String(e.message),a=String(e.data),s=parseInt(e.created_at),o=parseInt(e.updated_at),l=e.hasOwnProperty("custom_type")?String(e.custom_type):"",u=e.hasOwnProperty("translations")?e.translations:{},c=e.mentioned_users,new L(L.build(r,n,i,a,l,u,s,o,c))}return null},T.MESSAGE_TYPE_BASE="base",T.MESSAGE_TYPE_ADMIN="admin",T.MESSAGE_TYPE_USER="user",T.MESSAGE_TYPE_FILE="file";var L=function(e){this.messageType=T.MESSAGE_TYPE_ADMIN,e&&(this._update(e),this.message=String(e.message),this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.translations=e.hasOwnProperty("translations")?e.translations:{})};I(T,L),L.build=function(e,n,t,r,i,a,s,o,l){var u={msg_id:e,channel_url:n.url,channel_type:n.channelType===M.CHANNEL_TYPE_OPEN?M.CHANNEL_TYPE_OPEN:M.CHANNEL_TYPE_GROUP,ts:s,updated_at:o,message:t,data:r};return i&&(u.custom_type=i),a&&(u.translations=a),u.mentioned_users=[],l&&(u.mentioned_users=l),u},L.buildFromSerializedData=function(e){var n=f(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new L(L.build(n.messageId,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt,t))};var O=function(e){this.messageType=T.MESSAGE_TYPE_USER,e&&(this._update(e),this.message=String(e.message),this.data=e.hasOwnProperty("data")?String(e.data):"",this._sender=new G(e.user),u?this.sender=this._sender:Object.defineProperty(this,"sender",{get:function(){if(ae.getInstance().Options.UseMemberAsMessageSender&&this.isGroupChannel()){var e=w.cachedChannels[this.channelUrl];if(e){var n=e.memberMap[this._sender.userId];n&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.profileUrl!==n.profileUrl&&(this._sender.profileUrl=n.profileUrl),this._sender.metaData!==n.metaData&&(this._sender.metaData=n.metaData))}}return this._sender},set:function(e){this._sender=e}}),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.translations=e.hasOwnProperty("translations")?e.translations:{})};I(T,O),O.build=function(e,n,t,r,i,a,s,o,l,u,c,d){var h={};h.req_id=e,h.msg_id=n,h.channel_url=r.url,h.channel_type=r.channelType===M.CHANNEL_TYPE_OPEN?M.CHANNEL_TYPE_OPEN:M.CHANNEL_TYPE_GROUP,h.ts=l,h.updated_at=u,h.message=i,a&&(h.data=a),s&&(h.custom_type=s),o&&(h.translations=o);var I={};I.user_id=t.userId,I.nickname=t.nickname,I.profile_url=t.profileUrl;try{I.metadata="string"==typeof t.metaData?JSON.parse(t.metaData):t.metaData}catch(e){I.metadata={}}return h.user=I,h.mentioned_users=[],c&&(h.mentioned_users=c),d&&(h.mentioned_user_ids=d),h},O.buildFromSerializedData=function(e){var n=f(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new O(O.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt,t))};var D=function(e){if(this.messageType=T.MESSAGE_TYPE_FILE,e&&(this._update(e),this._sender=new G(e.user),u?this.sender=this._sender:Object.defineProperty(this,"sender",{get:function(){if(ae.getInstance().Options.UseMemberAsMessageSender&&this.isGroupChannel()){var e=w.cachedChannels[this.channelUrl];if(e){var n=e.memberMap[this._sender.userId];n&&(this._sender.nickname!==n.nickname&&(this._sender.nickname=n.nickname),this._sender.profileUrl!==n.profileUrl&&(this._sender.profileUrl=n.profileUrl),this._sender.metaData!==n.metaData&&(this._sender.metaData=n.metaData))}}return this._sender},set:function(e){this._sender=e}}),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.url=this.requireAuth?String(e.url).split("?auth=")[0]+"?auth="+X.getInstance().ekey:String(e.url).split("?auth=")[0],this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),this.data=e.hasOwnProperty("custom")?String(e.custom):"",this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth))for(var n in this.thumbnails)this.thumbnails[n].url=String(this.thumbnails[n].url).split("?auth=")[0]+"?auth="+X.getInstance().ekey};I(T,D),D.build=function(e,n,t,r,i,a,s,o,l,u,c,d,h,I,_,p){var E={};E.req_id=e,E.msg_id=n,E.channel_url=r.url,E.channel_type=r.channelType===M.CHANNEL_TYPE_OPEN?M.CHANNEL_TYPE_OPEN:M.CHANNEL_TYPE_GROUP,E.ts=c,E.updated_at=I,E.url=i,E.name=a,E.type=s,E.size=o,E.custom=l;var f={};f.user_id=t.userId,f.nickname=t.nickname,f.profile_url=t.profileUrl;try{f.metadata=JSON.parse(t.metaData)}catch(e){f.metadata={}}return E.user=f,u&&(E.custom_type=u),h&&(E.require_auth=h),d&&(E.thumbnails=d),E.mentioned_users=[],_&&(E.mentioned_users=_),p&&(E.mentioned_user_ids=p),E},D.buildFromSerializedData=function(e){var n=f(e),t=[];return n.mentionedUsers.forEach(function(e){t.push(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName))}),new D(D.build(n.reqId,n.messageId,n.sender,{url:n.channelUrl,channelType:n.channelType},n.url,n.name,n.type,n.size,n.data,n.customType,n.createdAt,n.thumbnails,n.requireAuth,n.updatedAt,t))};var M=function(e){this._update=function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral,this.fileUploadRequest={}},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));if(e.hasOwnProperty("lastMessage")&&null!==e.lastMessage&&"undefined"!=typeof e.lastMessage&&"object"==typeof e.lastMessage){var n=e.lastMessage;n.hasOwnProperty("_sender")&&(n.sender=n._sender,delete n._sender,e.lastMessage=n)}return E(e)},this.isGroupChannel=function(){return this.channelType===M.CHANNEL_TYPE_GROUP},this.isOpenChannel=function(){return this.channelType===M.CHANNEL_TYPE_OPEN},this.getMessageChangeLogsByToken=function(e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)return null;X.getInstance().getMessageChangeLogsByToken(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);var r=e.updated.map(function(e){return T.build(e,this)}),i=e.deleted.map(function(e){return e.message_id}),a=e.has_more,s=e.next;U({updatedMessages:r,deletedMessageIds:i,hasMore:a,token:s},null,n)})},this.createOperatorListQuery=function(){return new B(this)},this.createPreviousMessageListQuery=function(){return new z(this)},this.createMessageListQuery=function(){return new K(this)};var n=function(e,n,t,r,i,a,s,o,l){if(s===p.MessageTypeFilter.ADMIN?s="ADMM":s===p.MessageTypeFilter.USER?s="MESG":s===p.MessageTypeFilter.FILE?s="FILE":s===p.MessageTypeFilter.ALL&&(s=""),!h(n)||"boolean"!=typeof t||!h(r)||!h(i)||"boolean"!=typeof a||"string"!=typeof s||"string"!=typeof o)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),l);X.getInstance().messageList(e.isOpenChannel(),e.url,n,r,i,t,a,s,o,function(n,t){if(t)return void U(null,t,l);var r=n.messages,i=[];for(var a in r){var s=T.build(r[a],e);s&&i.push(s)}U(i,null,l)})},t=function(e,n,t,r,i,a,s,o,l){if(s===p.MessageTypeFilter.ADMIN?s="ADMM":s===p.MessageTypeFilter.USER?s="MESG":s===p.MessageTypeFilter.FILE?s="FILE":s===p.MessageTypeFilter.ALL&&(s=""),!h(n)||"boolean"!=typeof t||!h(r)||!h(i)||"boolean"!=typeof a||"string"!=typeof s||"string"!=typeof o)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),l);X.getInstance().messageListByID(e.isOpenChannel(),e.url,n,r,i,t,a,s,o,function(n,t){if(t)return void U(null,t,l);var r=n.messages,i=[];for(var a in r){var s=T.build(r[a],e);s&&i.push(s)}U(i,null,l)})};this.getNextMessagesByTimestamp=function(e,t,r,i,a,s,o){return n(this,e,t,0,r,i,a,s,o)},this.getPreviousMessagesByTimestamp=function(e,t,r,i,a,s,o){return n(this,e,t,r,0,i,a,s,o)},this.getPreviousAndNextMessagesByTimestamp=function(e,t,r,i,a,s,o){return n(this,e,!0,t,r,i,a,s,o)},this.getNextMessagesByID=function(e,n,r,i,a,s,o){return t(this,e,n,0,r,i,a,s,o)},this.getPreviousMessagesByID=function(e,n,r,i,a,s,o){return t(this,e,n,r,0,i,a,s,o)},this.getPreviousAndNextMessagesByID=function(e,n,r,i,a,s,o){return t(this,e,!0,n,r,i,a,s,o)},this._sendFileCommand=function(e,n,t,r,i,a,s,o,l,u,c,d,h){var I,p=this;I=h?h.reqId:Y.generateRequestId();var E=Y.bFile(I,e,n,t,r,i,a,s,o,l,u,c),f=D.build(E.requestId,0,ae.getInstance().currentUser,this,"string"==typeof n?n:"",t,r,i,a,s,null,null,!1,null,null,u),A=new D(f);return"string"==typeof n&&ae.getInstance().sendCommand(E,function(e,n){if(n)return void U(null,new _(n.message,n.code),d);var t=new D(e.getJsonElement()),r=ae.getInstance().currentUser;r&&t._sender&&r.userId===t._sender.userId&&(r.nickname!==t._sender.nickname&&(r.nickname=t._sender.nickname),r.profileUrl!==t._sender.profileUrl&&(r.profileUrl=t._sender.profileUrl)),p.isGroupChannel()&&w.getChannel(p.url,function(e,n){if(R){var r=e;e=n,n=r}if(n)return void U(null,n,d);e.lastMessage=t;for(var i in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[i].onChannelChanged(e)}}),U(t,null,d)}),A},this._getSendFileMessageParamInfo=function(e){var n={file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],callback:null,progressHandler:null,mentionedUserIds:[],pushNotificationDeliveryOption:ie.PushNotificationDeliveryOption.DEFAULT};switch("function"==typeof e.slice(-1)[0]&&(n.callback=e.pop()),"function"==typeof e.slice(-1)[0]&&(n.progressHandler=e.pop()),e.length){case 1:if(e[0]instanceof ie){var t=e[0];n.file=t.file?t.file:t.fileUrl,n.name=t.fileName,n.type=t.mimeType,n.size=t.fileSize,n.data=t.data,n.customType=t.customType,n.thumbnailSizes=t.thumbnailSizes,n.mentionedUserIds=t._mentionedIds,n.pushNotificationDeliveryOption=t.pushNotificationDeliveryOption?t.pushNotificationDeliveryOption:ie.PushNotificationDeliveryOption.DEFAULT}else n.file=e[0];break;case 2:n.file=e[0],n.data=e[1];break;case 3:n.file=e[0],n.data=e[1],n.customType=e[2];break;case 4:n.file=e[0],n.data=e[1],n.customType=e[2],n.thumbnailSizes=e[3];break;case 5:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4];break;case 6:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4],n.customType=e[5];break;case 7:n.file=e[0],n.name=e[1],n.type=e[2],n.size=e[3],n.data=e[4],n.customType=e[5],n.thumbnailSizes=e[6]}return"string"!=typeof n.file&&null!==n.file&&(null!==n.name&&"undefined"!=typeof n.name&&n.name||(n.name=n.file.name),null!==n.type&&"undefined"!=typeof n.type&&n.type||(n.type=n.file.type),null!==n.size&&"undefined"!=typeof n.size||(n.size=n.file.size)),null!==n.name&&"undefined"!=typeof n.name||(n.name=""),null!==n.type&&"undefined"!=typeof n.type||(n.type=""),null!==n.size&&"undefined"!=typeof n.size||(n.size=0),n},this.sendFileMessage=function(){var e=this,n=this._getSendFileMessageParamInfo(Array.prototype.slice.call(arguments)),t=n.file,r=n.name,i=n.type,a=n.size,s=n.data,o=n.customType,l=n.thumbnailSizes,u=n.callback,c=n.progressHandler,d=n.mentionedUserIds,I=n.pushNotificationDeliveryOption;if(null!==l&&void 0!==l||(l=[]),!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),u);if(null===t||void 0===t||null!==r&&void 0!==r&&"string"!=typeof r||null!==i&&void 0!==i&&"string"!=typeof i||null!==a&&void 0!==a&&(!h(a)||parseInt(a)<0)||null!==s&&void 0!==s&&"string"!=typeof s||null!==o&&void 0!==o&&"string"!=typeof o||!Array.isArray(l)||[ie.PushNotificationDeliveryOption.DEFAULT,ie.PushNotificationDeliveryOption.SUPPRESS].indexOf(I)<0)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),u);var p=e.url,E=null;return"string"==typeof t?E=e._sendFileCommand(p,t,r,i,a,s,o,[],!1,d,I,u):(E=e._sendFileCommand(p,t,r,i,a,s,o,[],!1,d,I,u),X.getInstance().uploadFile(t,i,l,p,function(n,t){if(t)return void U(null,t,u);var l="object"==typeof n?n:JSON.parse(n),c=l.url,h=l.hasOwnProperty("thumbnails")?l.thumbnails:[],_=!!l.hasOwnProperty("require_auth")&&l.require_auth;e._sendFileCommand(p,c,r,i,a,s,o,h,_,d,I,u,E)},c,this.fileUploadRequest,E.reqId)),E},this.cancelUploadingFileMessage=function(e,n){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n);if(!h(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);var t=this,r=t.fileUploadRequest[e];return r?(r.upload.onabort=function(){delete t.fileUploadRequest[e],U(!0,null,n)},r.abort(),!0):(U(!1,new _("Uploading has been completed or cancelled.",j.FILE_UPLOAD_CANCEL_FAILED),n),!1)},this.sendUserMessage=function(e,n,t,r,i){var a=this,s=[],o=re.PushNotificationDeliveryOption.DEFAULT;if("function"==typeof n&&(i=n,n="",t="",r=[],e instanceof re)){var l=e;e=l.message,n=l.data,t=l.customType,r=l.targetLanguages,s=l._mentionedIds,o=l.pushNotificationDeliveryOption?l.pushNotificationDeliveryOption:re.PushNotificationDeliveryOption.DEFAULT}if("function"==typeof t&&(i=t,t="",r=[]),"function"==typeof r&&(i=r,r=[]),r||(r=[]),"string"==typeof r&&(r=[r]),null===n&&(n=""),null===t&&(t=""),!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),i);if("string"!=typeof e||"string"!=typeof n||"string"!=typeof t||!Array.isArray(r)||[re.PushNotificationDeliveryOption.DEFAULT,re.PushNotificationDeliveryOption.SUPPRESS].indexOf(o)<0)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),i);var u=Y.bMessage(this.url,e,n,t,s,r,o),c=O.build(u.requestId,0,ae.getInstance().currentUser,this,e,n,t,r,(new Date).getTime(),null,null,s),d=new O(c);return ae.getInstance().sendCommand(u,function(e,n){if(n)return void U(null,new _(n.message,n.code),i);var t=new O(e.getJsonElement()),r=ae.getInstance().currentUser;r&&t._sender&&r.userId===t._sender.userId&&(r.nickname!==t._sender.nickname&&(r.nickname=t._sender.nickname),r.profileUrl!==t._sender.profileUrl&&(r.profileUrl=t._sender.profileUrl)),a.isGroupChannel()&&w.getChannel(a.url,function(e,n){if(R){var r=e;e=n,n=r}if(n)return void U(null,n,i);e.lastMessage=t;for(var a in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[a].onChannelChanged(e)}}),U(t,null,i)}),d},this.updateUserMessage=function(e,n,t,r,i){var a=Array.prototype.slice.call(arguments);if(5!==a.length)return"function"==typeof a.slice(-1)[0]&&(i=a.pop()),void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),i);if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),i);if(!h(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),i);if("string"!=typeof n&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof r&&null!==r&&void 0!==r)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),i);var s=Y.bUpdateUserMessage(this.url,e,n,t,r);ae.getInstance().sendCommand(s,function(e,n){if(n)return void U(null,new _(n.message,n.code),i);var t=new O(e.getJsonElement());U(t,null,i)})},this.updateFileMessage=function(e,n,t,r){var i=Array.prototype.slice.call(arguments);if(4!==i.length)return"function"==typeof i.slice(-1)[0]&&(r=i.pop()),void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),r);if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),r);if(!h(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),r);if("string"!=typeof n&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),r);var a=Y.bUpdateFileMessage(this.url,e,n,t);ae.getInstance().sendCommand(a,function(e,n){if(n)return void U(null,new _(n.message,n.code),r);var t=new D(e.getJsonElement());U(t,null,r)})},this.createMetaCounters=function(e,n){return ae.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||d(e)?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().createMetaCounters(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.updateMetaCounters=function(e,n,t){return ae.getInstance().hasLoggedIn()?("function"!=typeof n&&void 0!==t||(t=n,n=!1),null==e||"object"!=typeof e||Array.isArray(e)||d(e)||"boolean"!=typeof n?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),t):void X.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,n,X.UPDATE_META_COUNTER_MODE_SET,function(e,n){if(n)return void U(null,n,t);U(e,null,t)})):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),t)},this.increaseMetaCounters=function(e,n){return ae.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||d(e)?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,!1,X.UPDATE_META_COUNTER_MODE_INC,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.decreaseMetaCounters=function(e,n){return ae.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||d(e)?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().updateMetaCounters(this.isOpenChannel(),this.url,e,!1,X.UPDATE_META_COUNTER_MODE_DEC,function(e,t){if(t)return void U(null,t,n);var r=e,i={};for(var a in r){var s=r[a];i[a]=s}U(i,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.getMetaCounters=function(e,n){return ae.getInstance().hasLoggedIn()?Array.isArray(e)?void X.getInstance().getMetaCounters(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.getAllMetaCounters=function(e){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().getAllMetaCounters(this.isOpenChannel(),this.url,function(n,t){if(t)return void U(null,t,e);U(n,null,e)})},this.deleteMetaCounter=function(e,n){return ae.getInstance().hasLoggedIn()?"string"!=typeof e?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().deleteMetaCounter(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.deleteAllMetaCounters=function(e){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().deleteAllMetaCounters(this.isOpenChannel(),this.url,function(n,t){if(t)return void(e&&U(null,t,e));U(n,null,e)})},this.createMetaData=function(e,n){return ae.getInstance().hasLoggedIn()?null==e||"object"!=typeof e||Array.isArray(e)||d(e)?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().createMetaData(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.updateMetaData=function(e,n,t){return ae.getInstance().hasLoggedIn()?("function"!=typeof n&&void 0!==t||(t=n,n=!1),null==e||"object"!=typeof e||Array.isArray(e)||d(e)||"boolean"!=typeof n?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),t):void X.getInstance().updateMetaData(this.isOpenChannel(),this.url,e,n,function(e,n){if(n)return void U(null,n,t);U(e,null,t)})):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),t)},this.getMetaData=function(e,n){return ae.getInstance().hasLoggedIn()?Array.isArray(e)?void X.getInstance().getMetaData(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.getAllMetaData=function(e){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().getAllMetaData(this.isOpenChannel(),this.url,function(n,t){if(t)return void U(null,t,e);U(n,null,e)})},this.deleteMetaData=function(e,n){return ae.getInstance().hasLoggedIn()?"string"!=typeof e?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):void X.getInstance().deleteMetaData(this.isOpenChannel(),this.url,e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)}):void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n)},this.deleteAllMetaData=function(e){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().deleteAllMetaData(this.isOpenChannel(),this.url,function(n,t){if(t)return void(e&&U(null,t,e));U(n,null,e)})},this.deleteMessage=function(e,n){var t=Array.prototype.slice.call(arguments);if(2!==t.length)return"function"==typeof t.slice(-1)[0]&&(n=t.pop()),void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n);var r=this;if("object"!=typeof e||d(e)||Array.isArray(e)||Object.keys(e).indexOf("messageId")<0||!e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);X.getInstance().deleteMessage(r.isOpenChannel(),r.url,e.messageId,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.channelType=M.CHANNEL_TYPE_BASE,e&&this._update(e)};M.CHANNEL_TYPE_OPEN="open",M.CHANNEL_TYPE_GROUP="group",M.CHANNEL_TYPE_BASE="base";var b=function(e){this.parse=function(e){if(e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&e.operators){this.operators=[];for(var n in e.operators){var t=new G(e.operators[n]);this.operators.push(t)}}},this.refresh=function(e){b.getChannelWithoutCache(this.url,function(n,t){if(R){var r=n;n=t,t=r}if(t)return void U(null,t,e);U(n,null,e)})},this.update=function(e){this._update(e),this.parse(e)},this["delete"]=function(e){var n=this.url;X.getInstance().deleteOpenChannel(n,function(t,r){if(r)return void U(null,r,e);delete b.cachedChannels[n],U(t,null,e)})},this.enter=function(e){var n=this,t=Y.bEnter(n.url);ae.getInstance().sendCommand(t,function(t,r){if(r)return void U(null,new _(r.message,r.code),e);b.enteredChannels[n.url]=n,U(null,null,e)})},this.exit=function(e){var n=this,t=Y.bExit(n.url);ae.getInstance().sendCommand(t,function(t,r){if(r)return void U(null,new _(r.message,r.code),e);delete b.enteredChannels[n.url],U(null,null,e)})},this.createParticipantListQuery=function(){return new J(J.PARTICIPANT,this)},this.createMutedUserListQuery=function(){return new J(J.MUTED_USER,this)},this.createBannedUserListQuery=function(){return new J(J.BANNED_USER,this)},this.updateChannel=function(){var e=Array.prototype.slice.call(arguments),n=null,t=null,r=null,i=null,a=null,s=null;switch("function"==typeof e.slice(-1)[0]&&(s=e.pop()),e.length){case 3:n=e[0],t=e[1],r=e[2];break;case 4:n=e[0],t=e[1],r=e[2],i=e[3];break;case 5:n=e[0],t=e[1],r=e[2],i=e[3],a=e[4];break;default:return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),s)}this.updateChannelWithOperatorUserIds(n,t,r,i,a,s)},this.updateChannelWithOperatorUserIds=function(e,n,t,r,i,a){if("function"==typeof i&&(a=i,i=null),"string"!=typeof e&&null!==e&&void 0!==e||"string"!=typeof n&&d(n)&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof r&&!Array.isArray(r)&&null!==r&&void 0!==r||"string"!=typeof i&&null!==i&&void 0!==i)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),a);X.getInstance().updateOpenChannel(this.url,e,n,t,r,i,function(e,n){if(n)return void U(null,n,a);var t=b.upsert(e);U(t,null,a)})},this.banUser=function(e,n,t){if("function"==typeof n&&3!==arguments.length&&(t=n,n=-1),!e||parseInt(n)<0&&-1!==parseInt(n))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t);this.banUserWithUserId(e.userId,n,t)},this.banUserWithUserId=function(e,n,t){if("function"==typeof n&&3!==arguments.length&&(t=n,n=-1),!e||parseInt(n)<0&&-1!==parseInt(n))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t);X.getInstance().banUser(this.url,e,null,n,!1,function(e,n){if(n)return void U(null,n,t);U(null,null,t)})},this.unbanUser=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.unbanUserWithUserId(e.userId,n)},this.unbanUserWithUserId=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().unbanUser(this.url,e,!1,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.muteUser=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.muteUserWithUserId(e.userId,n)},this.muteUserWithUserId=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().muteUser(this.url,e,!1,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},
this.unmuteUser=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.unmuteUserWithUserId(e.userId,n)},this.unmuteUserWithUserId=function(e,n){if(!e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().unmuteUser(this.url,e,!1,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.isOperator=function(e){return!!e&&this.isOperatorWithUserId(e.userId)},this.isOperatorWithUserId=function(e){for(var n in this.operators)if(this.operators[n].userId===e)return!0;return!1},this.channelType=M.CHANNEL_TYPE_OPEN,this.participantCount=0,this.operators=[],e&&(this._update(e),this.parse(e))};I(M,b),b.enteredChannels={},b.clearEnteredChannels=function(){b.enteredChannels={}},b.createOpenChannelListQuery=function(){return new q},b.buildFromSerializedData=function(e){var n=f(e);return new b({channel_url:n.url,name:n.name,cover_url:n.coverUrl,data:n.data,custom_type:n.customType,created_at:n.createdAt/1e3,freeze:n.isFrozen,is_ephemeral:n.isEphemeral,participant_count:n.participantCount,operators:n.operators.map(function(e){return G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName)})})},b.createChannel=function(){var e,n,t,r,i,a;switch(arguments.length){case 1:a=arguments[0];break;case 4:e=arguments[0],n=arguments[1],t=arguments[2],a=arguments[3];break;case 5:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],a=arguments[4];break;case 6:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],a=arguments[5]}b.createChannelWithOperatorUserIds(e,n,t,r,i,a)},b.upsert=function(e){var n=new b(e);return b.cachedChannels.hasOwnProperty(n.url)?b.cachedChannels[n.url].update(e):b.cachedChannels[n.url]=n,b.cachedChannels[n.url]},b.createChannelWithOperatorUserIds=function(e,n,t,r,i,a){if("function"==typeof i&&(a=i,i=""),"string"!=typeof e&&null!==e&&void 0!==e||"string"!=typeof n&&d(n)&&null!==n&&void 0!==n||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof r&&!Array.isArray(r)&&null!==r&&void 0!==r||"string"!=typeof i&&null!==i&&void 0!==i)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),a);X.getInstance().createOpenChannel(e,n,t,r,i,function(e,n){if(n)return void U(null,n,a);var t=b.upsert(e);U(t,null,a)})},b.cachedChannels={},b.clearCache=function(){b.cachedChannels={}},b.removeCachedChannel=function(e){delete b.cachedChannels[e]},b.getChannel=function(e,n){if(!e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);b.cachedChannels.hasOwnProperty(e)?U(b.cachedChannels[e],null,n):b.getChannelWithoutCache(e,n)},b.getChannelWithoutCache=function(e,n){if(!e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);X.getInstance().getOpenChannel(e,function(t,r){if(r)return void U(null,r,n);b.upsert(t),U(b.cachedChannels[e],null,n)})};var w=function(e){var t,r,i={};this.parse=function(e){var n=this;if(n.isDistinct=!!e.is_distinct&&e.is_distinct,n.unreadMessageCount=parseInt(e.unread_message_count),n.isPushEnabled=!!e.is_push_enabled&&e.is_push_enabled,n.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,e.hasOwnProperty("read_receipt")){n.cachedReadReceiptStatus={};for(var t in e.read_receipt){var r=e.read_receipt[t];n.updateReadReceipt(t,parseInt(r))}}if(e.hasOwnProperty("members")){n.members=[],n.memberMap={};e.members.forEach(function(e){var t=new V(e);n.members.push(t),n.memberMap[t.userId]=t})}e.hasOwnProperty("member_state")?n.myMemberState=e.member_state:n.myMemberState="none",e.hasOwnProperty("member_count")&&(n.memberCount=parseInt(e.member_count)),e.hasOwnProperty("last_message")&&"object"==typeof e.last_message&&e.last_message?e.last_message instanceof T?n.lastMessage=e.last_message:n.lastMessage=T.build(e.last_message,n):n.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"==typeof e.inviter&&!d(e.inviter)?n.inviter=new G(e.inviter):n.inviter=null,e.hasOwnProperty("is_super")&&null!==e.is_super&&"boolean"==typeof e.is_super?n.isSuper=e.is_super:n.isSuper=!1,e.hasOwnProperty("is_public")&&null!==e.is_public&&"boolean"==typeof e.is_public?n.isPublic=e.is_public:n.isPublic=!1},this.refresh=function(e){w.getChannelWithoutCache(this.url,function(n,t){if(R){var r=n;n=t,t=r}if(t)return void U(null,t,e);U(n,null,e)})},this.update=function(e){this._update(e),this.parse(e)},this.updateChannel=function(){var e=this,n=Array.prototype.slice.call(arguments),t=null,r=null,i=null,a=null,s=null,o=null,l=null;switch("function"==typeof n.slice(-1)[0]&&(o=n.pop()),n.length){case 1:if(!(n[0]instanceof te))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),o);var u=n[0];t=u.isDistinct,r=u.name,i=u.channelCover,a=u.data,s=u.customType,l=u.isPublic;break;case 3:t=e.isDistinct,r=n[0],i=n[1],a=n[2];break;case 4:t=n[0],r=n[1],i=n[2],a=n[3];break;case 5:t=n[0],r=n[1],i=n[2],a=n[3],s=n[4];break;default:return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),o)}if("string"!=typeof r&&null!==r&&void 0!==r||"string"!=typeof i&&d(i)&&null!==i&&void 0!==i||"string"!=typeof a&&null!==a&&void 0!==a||"boolean"!=typeof t&&null!==t||"boolean"!=typeof l&&null!==l||"string"!=typeof s&&null!==s&&void 0!==s)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),o);X.getInstance().updateGroupChannel(e.url,t,r,i,a,s,l,function(e,n){if(n)return void U(null,n,o);var t=w.upsert(e);U(t,null,o)})},this.resetMyHistory=function(e){if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().resetMyHistory(this.url,function(n,t){if(t)return void U(null,t,e);U(n,null,e)})},this.invite=function(e,n){if("string"==typeof e&&(e=[{userId:e}]),!Array.isArray(e)||d(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);var t=[];for(var r in e){if("object"!=typeof e[r]||d(e[r])){U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);break}t.push(e[r].userId)}this.inviteWithUserIds(t,n)},this.inviteWithUserIds=function(e,n){if(!Array.isArray(e)||d(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);X.getInstance().groupChannelInvite(this.url,e,function(e,t){if(t)return void U(null,t,n);var r=w.upsert(e);U(r,null,n)})},this.acceptInvitation=function(e){X.getInstance().acceptInvitation(this.url,ae.getInstance().getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);var r=w.upsert(n);r.myMemberState="joined",w.cachedChannels[r.url]=r,U(r,null,e)})},this.declineInvitation=function(e){var n=this;X.getInstance().declineInvitation(this.url,ae.getInstance().getCurrentUserId(),function(t,r){if(r)return void U(null,r,e);n.myMemberState="none",w.cachedChannels[n.url]=n,n.isPublic||w.removeCachedChannel(n.url),U(t,null,e)})},this.hide=function(e,n){if(1===arguments.length&&"function"==typeof e&&(n=e,e=!1),null!==e&&void 0!==e||(e=!1),"boolean"!=typeof e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);var t=this.url,r=this;X.getInstance().groupChannelHide(t,ae.getInstance().getCurrentUserId(),e,function(i,a){if(a)return void U(null,a,n);r.isHidden=!0;var s=w.cachedChannels[t];s&&(s.isHidden=!0,e&&(s.unreadMessageCount=0),w.cachedChannels[t]=s),U(i,null,n)})},this.join=function(e){var n=this.url;X.getInstance().publicGroupChannelJoin(n,ae.getInstance().getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);var r=w.upsert(n);r.myMemberState="joined",w.cachedChannels[r.url]=r,U(r,null,e)})},this.leave=function(e){var n=this.url;X.getInstance().groupChannelLeave(n,ae.getInstance().getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);U(null,null,e)})},this.markAsRead=function(){this._sendMarkAsRead(null)},this._sendMarkAsRead=function(e){var n=this,t=Y.bRead(n.url);ae.getInstance().sendCommand(t,function(t,r){if(r)return void U(null,new _(r.message,r.code),e);if(n.unreadMessageCount>0){n.unreadMessageCount=0;for(var i in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[i].onChannelChanged(n)}}U(null,null,e)})},this.getReadReceipt=function(e){if(!(e instanceof T))return n.log("message is not BaseMessage instance"),-1;if(e.messageType===T.MESSAGE_TYPE_ADMIN)return 0;var t=ae.getInstance().currentUser,r=0,i=e.createdAt,a=this.members;for(var s in a){var o=a[s],l=o.userId;if(!(t.userId===l||e.sender&&e.sender.userId===l)){this.cachedReadReceiptStatus[l]<i&&r++}}return this.isSuper?0:r},this.getReadStatus=function(){var e={};if(!ae.getInstance().currentUser)return e;var n=this.members;for(var t in n){var r=n[t],i=r.userId;if(r.userId!==ae.getInstance().getCurrentUserId()){var a=this.cachedReadReceiptStatus[i];e[i]={user:r,last_seen_at:parseInt(a)}}}return e},this.updateReadReceipt=function(e,n){var t=e,r=this.cachedReadReceiptStatus[t],i=n;(!r||r<i)&&(this.cachedReadReceiptStatus[t]=i)},this.startTyping=function(){var e=(new Date).getTime();if(!(e-t<1e3)){r=0,t=e;var n=Y.bTypeStart(this.url,t);ae.getInstance().sendCommand(n,null)}},this.endTyping=function(){var e=(new Date).getTime();if(!(e-r<1e3)){t=0,r=e;var n=Y.bTypeEnd(this.url,r);ae.getInstance().sendCommand(n,null)}},this.invalidateTypingStatus=function(){var e=!1,n=(new Date).getTime();for(var t in i){n-i[t]>=1e4&&(delete i[t],e=!0)}return e},this.updateTypingStatus=function(e,n){n?i[e.userId]=(new Date).getTime():delete i[e.userId]},this.isTyping=function(){return 0!==Object.keys(i).length},this.getTypingMembers=function(){var e=[];for(var n in i){var t=this.memberMap[n];this.memberMap[n]&&e.push(t)}return e},this.addMember=function(e){var n=this.removeMember(e);n&&n.state===V.JOINED&&(e.state=V.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,0)},this.removeMember=function(e){var n=e.userId,t=null;if(this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var r in this.members){var i=this.members[r];if(i.userId===n){t=i,this.members.splice(r,1);break}}this.memberCount--}return null===t&&this.isSuper&&this.memberCount--,t},this.setPushPreference=function(e,n){var t=this;if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n);X.getInstance().setPushPreference(ae.getInstance().getCurrentUserId(),this.url,e,function(e,r){if(r)return void U(null,r,n);t.isPushEnabled=e.enable,U(e,null,n)})},this.getPushPreference=function(e){var n=this;if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e);X.getInstance().getPushPreference(ae.getInstance().getCurrentUserId(),this.url,function(t,r){if(r)return void U(null,r,e);if(e){var i;try{i=t.enable}catch(e){i=!1}n.isPushEnabled=i,U(i,null,e)}})},this.createMemberListQuery=function(){var e=this.url;return new x(e)},this.banUser=function(e,n,t,r){if(!e||!e.hasOwnProperty("userId")||"string"!=typeof t)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),r);this.banUserWithUserId(e.userId,n,t,r)},this.banUserWithUserId=function(e,n,t,r){if(!e||"string"!=typeof e||"string"!=typeof t)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),r);X.getInstance().banUser(this.url,e,t,n,!0,function(e,n){if(n)return void U(null,n,r);U(null,null,r)})},this.unbanUser=function(e,n){if(!e||!e.hasOwnProperty("userId"))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.unbanUserWithUserId(e.userId,n)},this.unbanUserWithUserId=function(e,n){if(!e||"string"!=typeof e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().unbanUser(this.url,e,!0,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.muteUser=function(e,n){if(!e||!e.hasOwnProperty("userId"))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.muteUserWithUserId(e.userId,n)},this.muteUserWithUserId=function(e,n){if(!e||"string"!=typeof e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().muteUser(this.url,e,!0,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.unmuteUser=function(e,n){if(!e||!e.hasOwnProperty("userId"))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);this.unmuteUserWithUserId(e.userId,n)},this.unmuteUserWithUserId=function(e,n){if(!e||"string"!=typeof e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);X.getInstance().unmuteUser(this.url,e,!0,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.freeze=function(e){X.getInstance().freeze(this.url,!0,!0,function(n,t){if(t)return void U(null,t,e);w.upsert(n),U(null,null,e)})},this.unfreeze=function(e){X.getInstance().freeze(this.url,!0,!1,function(n,t){if(t)return void U(null,t,e);w.upsert(n),U(null,null,e)})},this.createBannedUserListQuery=function(){return new J(J.BANNED_USER,this)},this.channelType=M.CHANNEL_TYPE_GROUP,this.isDistinct=!1,this.isSuper=!1,this.isPublic=!1,this.unreadMessageCount=0,this.inviter=null,this.members=[],this.memberMap={},this.lastMessage={},this.memberCount=0,this.cachedReadReceiptStatus={},this.isPushEnabled,this.isHidden=!1,e&&(this._update(e),this.parse(e))};I(M,w),w.buildFromSerializedData=function(e){var n=f(e);return new w({channel_url:n.url,name:n.name,cover_url:n.coverUrl,data:n.data,custom_type:n.customType,created_at:n.createdAt/1e3,is_distinct:n.isDistinct,is_super:n.isSuper,is_public:n.isPublic,freeze:n.isFrozen,is_ephemeral:n.isEphemeral,unread_message_count:n.unreadMessageCount,is_push_enabled:n.isPushEnabled,is_hidden:n.isHidden,member_count:n.memberCount,member_state:n.myMemberState,members:n.members.map(function(e){return V.build(G.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName),e.state,e.isBlockedByMe,e.isBlockingMe)}),last_message:function(e){return null!==e&&void 0!==e&&"object"==typeof e?e.messageType===T.MESSAGE_TYPE_USER?new O(O.build(e.reqId,e.messageId,e.sender,{url:e.channelUrl,channelType:e.channelType},e.message,e.data,e.customType,e.translations,e.createdAt,e.updatedAt)):e.messageType===T.MESSAGE_TYPE_FILE?new D(D.build(e.reqId,e.messageId,e.sender,{url:e.channelUrl,channelType:e.channelType},e.url,e.name,e.type,e.size,e.data,e.customType,e.createdAt,e.thumbnails,e.requireAuth,e.updatedAt)):new L(L.build(e.messageId,{url:e.channelUrl,channelType:e.channelType},e.message,e.data,e.customType,e.translations,e.createdAt,e.updatedAt)):null}(n.lastMessage),read_receipt:n.cachedReadReceiptStatus,inviter:null!==n.inviter&&"undefined"!=typeof n.inviter&&"object"==typeof n.inviter?G.build(n.inviter.userId,n.inviter.nickname,n.inviter.profileUrl,n.inviter.connectionStatus,n.inviter.lastSeenAt,n.inviter.metaData,n.inviter.isActive,n.inviter.friendDiscoveryKey,n.inviter.friendName):null})},w.createMyGroupChannelListQuery=function(){return new Q(ae.getInstance().currentUser)},w.createPublicGroupChannelListQuery=function(){return new W},w.memberState={ALL:0,JOINED:1,INVITED:2,INVITED_BY_FRIEND:3,INVITED_BY_NON_FRIEND:4},w.memberStateFilter={ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"},w.superChannelFilter={ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"},w.publicChannelFilter={ALL:"all",PUBLIC:"public",PRIVATE:"private"},w.getChannelCount=function(e,n){return"function"==typeof e&&1===arguments.length&&(n=e,e=w.memberState.ALL),e!==w.memberState.ALL&&e!==w.memberState.JOINED&&e!==w.memberState.INVITED&&e!==w.memberState.INVITED_BY_FRIEND&&e!==w.memberState.INVITED_BY_NON_FRIEND?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):ae.getInstance().hasLoggedIn()?void X.getInstance().getGroupChannelCount(ae.getInstance().getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);var r=parseInt(e.group_channel_count);U(r,null,n)}):void(n&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n))},w.getTotalUnreadMessageCount=function(e,n){if("function"==typeof e&&(n=e,e=null),null!==e&&void 0!==e&&!Array.isArray(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);X.getInstance().getTotalUnreadMessageCount(ae.getInstance().getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);var r=parseInt(e.unread_count);U(r,null,n)})},w.getTotalUnreadChannelCount=function(e){X.getInstance().getTotalUnreadChannelCount(ae.getInstance().getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);var r=parseInt(n.unread_count);U(r,null,e)})},w.createChannel=function(){var e=null,n=[],t=null,r=null,i=null,a=null,s=null,o=null,l=null,u={isPublic:null,channelUrl:null},c=[],h=null;switch(arguments.length){case 2:if(arguments[0]instanceof te){var I=arguments[0];n=I._inviteUserIds,e=[],t=I.isDistinct,r=I.isSuper,i=I.name,a=I.channelCover,s=I.data,l=I.customType,c=I._operatorIds,u.isPublic=I.isPublic,u.channelUrl=I.channelUrl,h=I.isEphemeral,o=arguments[1];break}e=arguments[0],t=!1,o=arguments[1];break;case 3:e=arguments[0],t=arguments[1],o=arguments[2];break;case 4:e=arguments[0],t=arguments[1],l=arguments[2],o=arguments[3];break;case 6:e=arguments[0],t=arguments[1],i=arguments[2],a=arguments[3],s=arguments[4],o=arguments[5];break;case 7:e=arguments[0],t=arguments[1],i=arguments[2],a=arguments[3],s=arguments[4],l=arguments[5],o=arguments[6]}if(!Array.isArray(e)||"boolean"!=typeof t&&null!==t||"boolean"!=typeof r&&null!==r||"boolean"!=typeof h&&null!==h||"boolean"!=typeof u.isPublic&&null!==u.isPublic||"string"!=typeof u.channelUrl&&null!==u.channelUrl||"string"!=typeof i&&null!==i&&void 0!==i||"string"!=typeof a&&d(a)&&null!==a&&void 0!==a||"string"!=typeof s&&null!==s&&void 0!==s||"string"!=typeof l&&null!==l&&void 0!==l)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),o);e.forEach(function(e){n.push(e.userId)}),w.createChannelWithUserIds(n,t,i,a,s,l,r,u,c,h,o)},w.createChannelWithUserIds=function(){var e=null,n=null,t=null,r=null,i=null,a=null,s=null,o=null,l=[],u={isPublic:null,channelUrl:null},c=null;switch(arguments.length){case 2:e=arguments[0],n=!1,a=arguments[1];break;case 3:e=arguments[0],n=arguments[1],a=arguments[2];break;case 4:e=arguments[0],n=arguments[1],s=arguments[2],a=arguments[3];break;case 6:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],a=arguments[5];break;case 7:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],a=arguments[6];break;case 8:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],o=arguments[6],a=arguments[7];break;case 9:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],o=arguments[6],u.isPublic=arguments[7].isPublic,u.channelUrl=arguments[7].channelUrl,a=arguments[8];break;case 10:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],o=arguments[6],u.isPublic=arguments[7].isPublic,u.channelUrl=arguments[7].channelUrl,l=arguments[8],a=arguments[9];break;case 11:e=arguments[0],n=arguments[1],t=arguments[2],r=arguments[3],i=arguments[4],s=arguments[5],o=arguments[6],u.isPublic=arguments[7].isPublic,u.channelUrl=arguments[7].channelUrl,l=arguments[8],c=arguments[9],a=arguments[10]}if(!ae.getInstance().hasLoggedIn())return void U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),a);if(!Array.isArray(e)||"boolean"!=typeof n&&null!==n||"boolean"!=typeof o&&null!==o||"boolean"!=typeof c&&null!==c||"boolean"!=typeof u.isPublic&&null!==u.isPublic||"string"!=typeof u.channelUrl&&null!==u.channelUrl||"string"!=typeof t&&null!==t&&void 0!==t||"string"!=typeof r&&d(r)&&null!==r&&void 0!==r||"string"!=typeof i&&null!==i&&void 0!==i||"string"!=typeof s&&null!==s&&void 0!==s)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),a);var h=e.filter(function(e,n,t){return n===t.indexOf(e)}),I=ae.getInstance().currentUser;h.push(I.userId),X.getInstance().createGroupChannel(h,n,t,r,i,s,o,u,l,c,function(e,n){if(n)return void U(null,n,a);var t=new w(e);w.cachedChannels[t.url]=t,U(t,null,a)})},w.cachedChannels={},w.clearCache=function(){w.cachedChannels={}},w.removeCachedChannel=function(e){delete w.cachedChannels[e]},w.upsert=function(e){var n=new w(e);if(w.cachedChannels.hasOwnProperty(n.url)){if(n.isEphemeral){var t=w.cachedChannels[n.url];e.last_message=t.lastMessage,e.unread_message_count=t.unreadMessageCount}w.cachedChannels[n.url].update(e)}else w.cachedChannels[n.url]=n;return w.cachedChannels[n.url]},w.getChannelWithoutCache=function(e,n){if(!e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);X.getInstance().getGroupChannel(e,!0,!0,function(e,t){if(t)return void U(null,t,n);var r=w.upsert(e);U(r,null,n)})},w.getChannel=function(e,n){if(!e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);w.cachedChannels.hasOwnProperty(e)?U(w.cachedChannels[e],null,n):w.getChannelWithoutCache(e,n)},w.markAsReadAllLastSentAt,w.markAsReadAll=function(e){ae.getInstance().markAsReadAll(e)};var H=function(e){e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0,this.data=e.hasOwnProperty("data")?e.data:null,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):M.CHANNEL_TYPE_GROUP),this.isGroupChannel=function(){return this.channelType===M.CHANNEL_TYPE_GROUP},this.isOpenChannel=function(){return this.channelType===M.CHANNEL_TYPE_OPEN}};H.CATEGORY_NONE=0,H.CATEGORY_CHANNEL_ENTER=10102,H.CATEGORY_CHANNEL_EXIT=10103,H.CATEGORY_USER_CHANNEL_MUTE=10201,H.CATEGORY_USER_CHANNEL_UNMUTE=10200,H.CATEGORY_USER_CHANNEL_BAN=10601,H.CATEGORY_USER_CHANNEL_UNBAN=10600,H.CATEGORY_CHANNEL_FREEZE=10701,H.CATEGORY_CHANNEL_UNFREEZE=10700,H.CATEGORY_TYPING_START=10900,H.CATEGORY_TYPING_END=10901,H.CATEGORY_CHANNEL_JOIN=1e4,H.CATEGORY_CHANNEL_LEAVE=10001,H.CATEGORY_CHANNEL_INVITE=10020,H.CATEGORY_CHANNEL_DECLINE_INVITE=10022,H.CATEGORY_CHANNEL_PROP_CHANGED=11e3,H.CATEGORY_CHANNEL_DELETED=12e3,H.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,H.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,H.CATEGORY_CHANNEL_HIDE=13e3;var k=function(e){e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)};k.CATEGORY_USER_BLOCK=20001,k.CATEGORY_USER_UNBLOCK=2e4,k.CATEGORY_FRIEND_DISCOVERED=20900;var F=function(e){e&&(this.reader=new G(e.user),this.timestamp=parseInt(e.ts),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):M.CHANNEL_TYPE_GROUP)},G=function(e){this.nickname="",this.profileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this.getOriginalProfileUrl=function(){var e="";if(e=this.profileUrl.indexOf("://")>-1?this.profileUrl.split("/")[2]:this.profileUrl.split("/")[0],e=e.split("?")[0],(e.indexOf("sendbird.com")>-1||e.indexOf("intoz.com")>-1)&&this.profileUrl.indexOf(e+"/profile_images/")>-1){var n=this.profileUrl.replace("profile_images/","");return n===this.profileUrl?"":n}return""},this._update=function(e){e.hasOwnProperty("guest_id")&&(this.userId=String(e.guest_id)),e.hasOwnProperty("user_id")&&(this.userId=String(e.user_id)),e.hasOwnProperty("name")&&(this.nickname=String(e.name)),e.hasOwnProperty("nickname")&&(this.nickname=String(e.nickname)),e.hasOwnProperty("image")&&(this.profileUrl=String(e.image)),e.hasOwnProperty("profile_url")&&(this.profileUrl=String(e.profile_url)),e.hasOwnProperty("is_online")?e.is_online===G.NON_AVAILABLE?this.connectionStatus=G.NON_AVAILABLE:this.connectionStatus=e.is_online?G.ONLINE:G.OFFLINE:this.connectionStatus=G.NON_AVAILABLE,e.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(e.last_seen_at):this.lastSeenAt=0,e.hasOwnProperty("metadata")?this.metaData=e.metadata:this.metaData={},e.hasOwnProperty("is_active")?this.isActive="undefined"==typeof e.is_active||e.is_active:this.isActive=!0,e.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=e.friend_discovery_key:this.friendDiscoveryKey=null,e.hasOwnProperty("friend_name")?this.friendName=e.friend_name:this.friendName=null},this._updateMetaData=function(e,n){var t=this,r=Object.keys(e);n?r.forEach(function(e){delete t.metaData[e]}):r.forEach(function(n){t.metaData[n]=e[n]})},this.createMetaData=function(e,n){var t=this;return"function"==typeof e&&1===arguments.length&&(n=e,e={}),"object"!=typeof e||d(e)||Array.isArray(e)?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n):ae.getInstance().hasLoggedIn()?void X.getInstance().createUserMetaData(t.userId,e,function(e,r){if(r)return void U(null,r,n);t._updateMetaData(e),U(e,null,n)}):void(n&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n))},this.updateMetaData=function(e,n,t){var r=this;return"function"==typeof e&&1===arguments.length&&(t=e,e={}),"function"==typeof n&&2===arguments.length&&(t=n,n=!1),"object"!=typeof e||d(e)||Array.isArray(e)||"boolean"!=typeof n?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t):ae.getInstance().hasLoggedIn()?void X.getInstance().updateUserMetaData(r.userId,e,n,function(e,n){if(n)return void U(null,n,t);r._updateMetaData(e),U(e,null,t)}):void(t&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),t))},this.deleteAllMetaData=function(e){var n=this,t=n.metaData;if(!ae.getInstance().hasLoggedIn())return void(e&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),e));X.getInstance().deleteAllUserMetaData(n.userId,function(r,i){if(i)return void U(null,i,e);n._updateMetaData(t,!0),U(r,null,e)})},this.deleteMetaData=function(e,n){var t=this;if("function"==typeof e&&1===arguments.length&&(n=e,e=null),"string"!=typeof e)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);if(!ae.getInstance().hasLoggedIn())return void(n&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n));var r={};r[e]="",X.getInstance().deleteUserMetaData(t.userId,e,function(e,i){if(i)return void U(null,i,n);t._updateMetaData(r,!0),U(e,null,n)})},this.serialize=function(){var e=JSON.parse(JSON.stringify(this));return E(e)},e&&this._update(e)};G.NON_AVAILABLE="nonavailable",G.ONLINE="online",G.OFFLINE="offline",G.build=function(e,n,t,r,i,a,s,o,l){return{user_id:e,nickname:n,profile_url:t,is_online:r,last_seen_at:i,metadata:a,is_active:s,friend_discovery_key:o,friend_name:l}},G.buildFromSerializedData=function(e){var n=f(e);return new G(G.build(n.userId,n.nickname,n.profileUrl,n.connectionStatus,n.lastSeenAt,n.metaData,n.isActive,n.friendDiscoveryKey,n.friendName))};var V=function(e){this.state="",this.isBlockedByMe=!1,this.isBlockingMe=!1,this.parse=function(e){this.state=e.state,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)},e&&(this._update(e),this.parse(e))};I(G,V),V.JOINED="joined",V.INVITED="invited",V.build=function(e,n,t,r){var i=e;return i.state=n,i.is_blocked_by_me=t,i.is_blocking_me=r,i},V.buildFromSerializedData=function(e){var n=f(e);return new V(V.build(G.build(n.userId,n.nickname,n.profileUrl,n.connectionStatus,n.lastSeenAt,n.metaData,n.isActive,n.friendDiscoveryKey,n.friendName),n.state,n.isBlockedByMe,n.isBlockingMe))};var Y=function(e,n,t){this.isAckRequired=function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command},this.encode=function(){return this.command+this.payload+"\n"},this.decode=function(e){e=e.trim(),this.command=e.substring(0,4),this.payload=e.substring(4)},this.getJsonElement=function(){return JSON.parse(this.payload)},this.isRequestIdCommand=function(){return this.isAckRequired()||"EROR"===this.command},this.command,this.payload,this.requestId;var r=this;if(0!==arguments.length){var i;switch(arguments.length){case 1:var a=arguments[0];if(!a||a.length<=4)return r.command="NOOP",void(r.payload="{}");if(a=a.trim(),r.command=a.substring(0,4),r.payload=a.substring(4),r.isRequestIdCommand()){var s=r.getJsonElement();s&&(r.requestId=s.hasOwnProperty("req_id")?s.req_id:"")}break;case 3:i=arguments[2];case 2:var o=arguments[0],l=arguments[1];i=i||"",r.command=o,r.requestId=i,r.requestId||r.isRequestIdCommand()&&(r.requestId=Y.generateRequestId()),l.req_id=r.requestId,r.payload=JSON.stringify(l)}}};Y.bMessage=function(e,n,t,r,i,a,s){var o={};return o.channel_url=e,o.message=n,o.data=t,o.mentioned_user_ids=[],Array.isArray(i)&&i.length>0&&(o.mentioned_user_ids=i),r&&(o.custom_type=r),a.length>0&&(o.target_langs=a),s&&s!==re.PushNotificationDeliveryOption.DEFAULT&&(o.push_option=s),new Y("MESG",o)},Y.bRead=function(e){var n={};return n.channel_url=e,new Y("READ",n)},Y.bTypeStart=function(e,n){var t={};return t.channel_url=e,t.time=n,new Y("TPST",t)},Y.bTypeEnd=function(e,n){var t={};return t.channel_url=e,t.time=n,new Y("TPEN",t)},Y.bFile=function(e,n,t,r,i,a,s,o,l,u,c,d){var h={};h.channel_url=n,h.url=t,h.name=r||"",h.type=i||"",h.size=a||0,h.custom=s,o&&(h.custom_type=o),l&&(h.thumbnails=l),u&&(h.require_auth=u),h.mentioned_user_ids=[];for(var I in c){var _=c[I];h.mentioned_user_ids.push(String(_))}return d&&d!==ie.PushNotificationDeliveryOption.DEFAULT&&(h.push_option=d),new Y("FILE",h,e)},Y.bPing=function(){var e={};return e.id=(new Date).getTime(),new Y("PING",e)},Y.bEnter=function(e){var n={};return n.channel_url=e,new Y("ENTR",n)},Y.bExit=function(e){var n={};return n.channel_url=e,new Y("EXIT",n)},Y.bUpdateUserMessage=function(e,n,t,r,i){var a={};return a.channel_url=e,a.msg_id=n,null!=t&&t!==undefined&&(a.message=t),null!=r&&r!==undefined&&(a.data=r),null!=i&&i!==undefined&&(a.custom_type=i),new Y("MEDI",a)},Y.bUpdateFileMessage=function(e,n,t,r){var i={};return i.channel_url=e,i.msg_id=n,null!=t&&t!==undefined&&(i.data=t),null!=r&&r!==undefined&&(i.custom_type=r),new Y("FEDI",i)},Y.requestIdSeed=(new Date).getTime(),Y.generateRequestId=function(){return Y.requestIdSeed++,String(Y.requestIdSeed)};var B=function(e){this.isLoading=!1,this.hasNext=!0,this.limit=20;var n="",t=this;this.next=function(r){return t.hasNext?t.isLoading?void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),r):"number"!=typeof t.limit||t.limit<1?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),r):(t.isLoading=!0,void X.getInstance().loadOperatorList(e.url,e.isOpenChannel(),n,t.limit,function(e,i){if(i)return t.isLoading=!1,void U(null,i,r);var a=e;(!(n=String(a.next))||n.length<=0)&&(t.hasNext=!1);var s=a.operators.map(function(e){return new G(e)});t.isLoading=!1,U(s,null,r)})):void U([],null,r)}},x=function(e){this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=x.MUTED_MEMBER_FILTER.ALL,this.operatorFilter=x.OPERATOR_FILTER.ALL;var n="",t=this;this.next=function(r){return t.hasNext?t.isLoading?void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),r):"number"!=typeof t.limit||t.limit<1||"string"!=typeof t.mutedMemberFilter||[x.MUTED_MEMBER_FILTER.ALL,x.MUTED_MEMBER_FILTER.MUTED,x.MUTED_MEMBER_FILTER.UNMUTED].indexOf(t.mutedMemberFilter.toLowerCase())<0||"string"!=typeof t.operatorFilter||[x.OPERATOR_FILTER.ALL,x.OPERATOR_FILTER.OPERATOR,x.OPERATOR_FILTER.NONOPERATOR].indexOf(t.operatorFilter.toLowerCase())<0?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),r):(t.isLoading=!0,void X.getInstance().loadGroupChannelMemberList(e,n,t.limit,t.mutedMemberFilter,t.operatorFilter,function(e,i){if(i)return t.isLoading=!1,void U(null,i,r);var a=e;(!(n=String(a.next))||n.length<=0)&&(t.hasNext=!1);var s=a.members.map(function(e){return new V(e)});t.isLoading=!1,U(s,null,r)})):void U([],null,r)}};x.MUTED_MEMBER_FILTER={ALL:"all",MUTED:"muted",UNMUTED:"unmuted"},x.OPERATOR_FILTER={ALL:"all",OPERATOR:"operator",NONOPERATOR:"nonoperator"};var Q=function(e){this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=Q.ORDER_LATEST_LAST_MESSAGE,this.userIdsFilter=[],
this.userIdsFilterExactMatch=!1,this.queryType="AND";var n={userIds:[],includeMode:!0,queryType:W.USER_IDS_INCLUDE_QUERY_TYPE.AND};this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=W.USER_IDS_INCLUDE_QUERY_TYPE.AND,u?(this.userIdsExactFilter=this._userIdsExactFilter,this.userIdsIncludeFilter=this._userIdsIncludeFilter,this.userIdsIncludeFilterQueryType=this._userIdsIncludeFilterQueryType):(Object.defineProperty(this,"userIdsExactFilter",{get:function(){return this._userIdsExactFilter},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],n={userIds:this._userIdsExactFilter,includeMode:!1}}}),Object.defineProperty(this,"userIdsIncludeFilter",{get:function(){return this._userIdsIncludeFilter},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],n={userIds:this._userIdsIncludeFilter,includeMode:!0}}}),Object.defineProperty(this,"userIdsIncludeFilterQueryType",{get:function(){return this._userIdsIncludeFilterQueryType},set:function(e){this._userIdsIncludeFilterQueryType=e,n={queryType:this._userIdsIncludeFilterQueryType}}})),this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=w.memberStateFilter.ALL,this.customTypeFilter="",this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=w.superChannelFilter.ALL,this.publicChannelFilter=w.publicChannelFilter.ALL,this.customTypeStartsWithFilter=null;var t=e,r="",i=this;this.next=function(e){if(!i.hasNext)return void U([],null,e);if(i.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),e);if(null!==i.nicknameContainsFilter&&"undefined"!=typeof i.nicknameContainsFilter||(i.nicknameContainsFilter=""),null!==i.channelNameContainsFilter&&"undefined"!=typeof i.channelNameContainsFilter||(i.channelNameContainsFilter=""),null!==i.customTypeStartsWithFilter&&"string"!=typeof i.customTypeStartsWithFilter)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),e);if(!Array.isArray(i._userIdsExactFilter)||!Array.isArray(i._userIdsIncludeFilter)||"string"!=typeof i._userIdsIncludeFilterQueryType||[W.USER_IDS_INCLUDE_QUERY_TYPE.AND,W.USER_IDS_INCLUDE_QUERY_TYPE.OR].indexOf(i._userIdsIncludeFilterQueryType.toUpperCase())<0)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),e);if("number"==typeof i.memberStateFilter){if(typeof i.memberStateFilter<0||typeof i.memberStateFilter>4)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),e);var a=["all","joined_only","invited_only","invited_by_friend","invited_by_non_friend"];i.memberStateFilter=a[i.memberStateFilter]}if(!h(i.limit)||!Array.isArray(i.userIdsFilter)||"boolean"!=typeof i.userIdsFilterExactMatch||"string"!=typeof i.customTypeFilter||!Array.isArray(i.customTypesFilter)||"string"!=typeof i.queryType||["AND","OR"].indexOf(i.queryType.toUpperCase())<0||"string"!=typeof i.order||[Q.ORDER_CHRONOLOGICAL,Q.ORDER_LATEST_LAST_MESSAGE,Q.CHANNEL_NAME_ALPHABETICAL].indexOf(i.order.toLowerCase())<0||"string"!=typeof i.memberStateFilter||[w.memberStateFilter.ALL,w.memberStateFilter.JOINED,w.memberStateFilter.INVITED,w.memberStateFilter.INVITED_BY_FRIEND,w.memberStateFilter.INVITED_BY_NON_FRIEND].indexOf(i.memberStateFilter.toLowerCase())<0||"string"!=typeof i.nicknameContainsFilter||"string"!=typeof i.channelNameContainsFilter||!Array.isArray(i.channelUrlsFilter)||"string"!=typeof i.superChannelFilter||[w.superChannelFilter.ALL,w.superChannelFilter.SUPER,w.superChannelFilter.NON_SUPER].indexOf(i.superChannelFilter.toLowerCase())<0||"string"!=typeof i.publicChannelFilter||[w.publicChannelFilter.ALL,w.publicChannelFilter.PUBLIC,w.publicChannelFilter.PRIVATE].indexOf(i.publicChannelFilter.toLowerCase())<0)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),e);Array.isArray(i.userIdsFilter)&&i.userIdsFilter.length>0&&(n={userIds:i.userIdsFilter,includeMode:!i.userIdsFilterExactMatch,queryType:i.queryType}),i.isLoading=!0,X.getInstance().loadUserGroupChannelList(t.userId,r,i.limit,i.includeEmpty,i.order,n,i.nicknameContainsFilter,i.channelNameContainsFilter,i.channelUrlsFilter,i.customTypeFilter,i.customTypesFilter,i.customTypeStartsWithFilter,i.memberStateFilter,i.superChannelFilter,i.publicChannelFilter,function(n,t){if(t)return i.isLoading=!1,void U(null,t,e);var a=n;(!(r=String(a.next))||r.length<=0)&&(i.hasNext=!1);var s=a.channels,o=[];for(var l in s){var u=w.upsert(s[l]);o.push(u)}i.isLoading=!1,U(o,null,e)})}};Q.ORDER_LATEST_LAST_MESSAGE="latest_last_message",Q.ORDER_CHRONOLOGICAL="chronological",Q.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",Q.MEMBER_STATE_INVITED_ONLY="invited_only",Q.MEMBER_STATE_JOINED_ONLY="joined_only",Q.MEMBER_STATE_ALL="all";var W=function(){var e="";this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!0,this.order=W.ORDER_CHRONOLOGICAL,this.channelNameContainsFilter=null,this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=w.superChannelFilter.ALL,this.membershipFilter=W.MEMBERSHIP_TYPE.JOINED;var n=this;this.next=function(t){return ae.getInstance().hasLoggedIn()?n.hasNext?n.isLoading?void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),t):!h(n.limit)||"boolean"!=typeof n.includeEmpty||!Array.isArray(n.customTypesFilter)||!Array.isArray(n.channelUrlsFilter)||null!==n.channelNameContainsFilter&&"string"!=typeof n.channelNameContainsFilter||null!==n.customTypeStartsWithFilter&&"string"!=typeof n.customTypeStartsWithFilter||"string"!=typeof n.order||[W.ORDER_CHRONOLOGICAL,W.ORDER_LATEST_LAST_MESSAGE,W.CHANNEL_NAME_ALPHABETICAL].indexOf(n.order.toLowerCase())<0?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t):"string"!=typeof n.superChannelFilter||[w.superChannelFilter.ALL,w.superChannelFilter.SUPER,w.superChannelFilter.NON_SUPER].indexOf(n.superChannelFilter.toLowerCase())<0||"string"!=typeof n.membershipFilter||[W.MEMBERSHIP_TYPE.ALL,W.MEMBERSHIP_TYPE.JOINED].indexOf(n.membershipFilter.toLowerCase())<0?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t):(n.isLoading=!0,void X.getInstance().loadPublicGroupChannelList(e,n.limit,n.includeEmpty,n.order,n.channelNameContainsFilter,n.channelUrlsFilter,n.customTypesFilter,n.customTypeStartsWithFilter,n.superChannelFilter,n.membershipFilter,function(r,i){if(i)return n.isLoading=!1,void U(null,i,t);var a=r;(!(e=String(a.next))||e.length<=0)&&(n.hasNext=!1);var s=a.channels,o=[];for(var l in s){var u=w.upsert(s[l]);o.push(u)}n.isLoading=!1,U(o,null,t)})):void U([],null,t):void(t&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),t))}};W.ORDER_CHRONOLOGICAL="chronological",W.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",W.USER_IDS_INCLUDE_QUERY_TYPE={AND:"AND",OR:"OR"},W.MEMBERSHIP_TYPE={ALL:"all",JOINED:"joined"};var K=function(e){this.isLoading=!1;var n=e,t=this;this.next=function(e,r,i,a){if(t.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),a);if(4!==arguments.length){if("function"!=typeof a){var s=Array.prototype.slice.call(arguments);"function"==typeof s.slice(-1)[0]&&(a=s.pop())}return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),a)}if(!h(e)||!h(r)||"boolean"!=typeof i)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),a);t.isLoading=!0,X.getInstance().messageList(n.isOpenChannel(),n.url,e,0,r,!1,i,"","",function(e,r){if(r)return t.isLoading=!1,void U(null,r,a);var i=e.messages,s=[];for(var o in i){var l=T.build(i[o],n);l&&s.push(l)}t.isLoading=!1,U(s,null,a)})},this.prev=function(e,r,i,a){if(t.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),a);if(4!==arguments.length){if("function"!=typeof a){var s=Array.prototype.slice.call(arguments);"function"==typeof s.slice(-1)[0]&&(a=s.pop())}return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),a)}if(!h(e)||!h(r)||"boolean"!=typeof i)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),a);t.isLoading=!0,X.getInstance().messageList(n.isOpenChannel(),n.url,e,r,0,!1,i,"","",function(e,r){if(r)return t.isLoading=!1,void U(null,r,a);var i=e.messages,s=[];for(var o in i){var l=T.build(i[o],n);l&&s.push(l)}t.isLoading=!1,U(s,null,a)})},this.load=function(e,r,i,a,s){if(t.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),s);if(5!==arguments.length){if("function"!=typeof s){var o=Array.prototype.slice.call(arguments);"function"==typeof o.slice(-1)[0]&&(s=o.pop())}return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),s)}if(!h(e)||!h(r)||!h(i)||"boolean"!=typeof a)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),s);t.isLoading=!0,X.getInstance().messageList(n.isOpenChannel(),n.url,e,r,i,!0,a,"","",function(e,r){if(r)return t.isLoading=!1,void U(null,r,s);var i=e.messages,a=[];for(var o in i){var l=T.build(i[o],n);l&&a.push(l)}t.isLoading=!1,U(a,null,s)})}},q=function(){var e="";this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customType=null;var n=this;this.next=function(t){return this.hasNext?this.isLoading?void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),t):"string"!=typeof n.nameKeyword&&null!==n.nameKeyword||"string"!=typeof n.urlKeyword&&null!==n.urlKeyword||"string"!=typeof n.customType&&null!==n.customType||!h(n.limit)?void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),t):(n.isLoading=!0,void X.getInstance().loadOpenChannelList(e,n.limit,n.nameKeyword,n.urlKeyword,n.customType,function(r,i){if(i)return n.isLoading=!1,void U(null,i,t);var a=r;try{e=String(a.next)}catch(n){e=""}e||(n.hasNext=!1);var s=a.channels,o=[];s.forEach(function(e){var n=b.upsert(e);o.push(n)}),n.isLoading=!1,U(o,null,t)})):void U([],null,t)}},z=function(e){var n=e,t=0x8000000000000000;this.hasMore=!0,this.isLoading=!1;var r=this;this.load=function(e,i,a,s){if(3!==arguments.length&&4!==arguments.length){if("function"!=typeof s){var o=Array.prototype.slice.call(arguments);"function"==typeof o.slice(-1)[0]&&(s=o.pop())}return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),s)}if("function"==typeof a&&(s=a,a=""),a.toString().toLowerCase()===T.MESSAGE_TYPE_ADMIN||a===p.MessageTypeFilter.ADMIN?a="ADMM":a.toString().toLowerCase()===T.MESSAGE_TYPE_USER||a===p.MessageTypeFilter.USER?a="MESG":a.toString().toLowerCase()===T.MESSAGE_TYPE_FILE||a===p.MessageTypeFilter.FILE?a="FILE":null!==a&&void 0!==a&&a!==p.MessageTypeFilter.ALL||(a=""),!h(e)||"boolean"!=typeof i||"string"!=typeof a)return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),s);if(r.hasMore){if(r.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),s);r.isLoading=!0,X.getInstance().messageList(n.isOpenChannel(),n.url,t,e,0,!1,i,a,"",function(i,a){if(a)return r.isLoading=!1,void U(null,a,s);var o=i.messages,l=[];for(var u in o){var c=T.build(o[u],n);c&&(l.push(c),c.createdAt<=t&&(t=c.createdAt))}(l.length<=0||l.length<e)&&(r.hasMore=!1),r.isLoading=!1,U(l,null,s)})}}},J=function(e,n){var t,r,i,a="";this.hasNext=!0,this.limit=20,this.isLoading=!1,this.userIds=[],this.metaDataKey="",this.metaDataValues=[];var s=this;switch(n&&(r=n),t=e){case J.ALL_USER:case J.BLOCKED_USER:i="users";break;case J.FILTERED_USER:this.userIds=n,i="users";break;case J.PARTICIPANT:i="participants";break;case J.MUTED_USER:i="muted_list";break;case J.BANNED_USER:i="banned_list"}this.next=function(n){if(!s.hasNext)return void U([],null,n);if(!ae.getInstance().hasLoggedIn())return void(n&&U(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED),n));if(s.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),n);if(!h(s.limit)||!Array.isArray(s.userIds)||"string"!=typeof s.metaDataKey||!Array.isArray(s.metaDataValues)||s.metaDataKey&&d(s.metaDataValues)||!s.metaDataKey&&!d(s.metaDataValues))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);s.isLoading=!0;var o=function(t,r){if(r)return s.isLoading=!1,void U(null,r,n);(a=t.next)||(s.hasNext=!1);var o=t[i],l=[];for(var u in o)e===J.BANNED_USER?l.push(new G(o[u].user)):l.push(new G(o[u]));s.isLoading=!1,U(l,null,n)};switch(t){case J.ALL_USER:X.getInstance().loadUserList(a,s.limit,[],s.metaDataKey,s.metaDataValues,o);break;case J.FILTERED_USER:X.getInstance().loadUserList(a,s.limit,s.userIds,s.metaDataKey,s.metaDataValues,o);break;case J.BLOCKED_USER:X.getInstance().loadBlockedUserList(ae.getInstance().getCurrentUserId(),a,s.limit,o);break;case J.PARTICIPANT:X.getInstance().loadOpenChannelParticipantList(r.url,a,s.limit,o);break;case J.MUTED_USER:X.getInstance().loadMutedUserList(r,a,s.limit,o);break;case J.BANNED_USER:X.getInstance().loadBannedUserList(r,a,s.limit,o)}}};J.ALL_USER="alluser",J.FILTERED_USER="filtereduser",J.BLOCKED_USER="blockeduser",J.PARTICIPANT="participant",J.MUTED_USER="muteduser",J.BANNED_USER="banneduser";var j=function(){};j.INVALID_INITIALIZATION=800100,j.CONNECTION_REQUIRED=800101,j.INVALID_PARAMETER=800110,j.NETWORK_ERROR=800120,j.NETWORK_ROUTING_ERROR=800121,j.MALFORMED_DATA=800130,j.MALFORMED_ERROR_DATA=800140,j.WRONG_CHANNEL_TYPE=800150,j.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160,j.QUERY_IN_PROGRESS=800170,j.ACK_TIMEOUT=800180,j.LOGIN_TIMEOUT=800190,j.WEBSOCKET_CONNECTION_CLOSED=800200,j.WEBSOCKET_CONNECTION_FAILED=800210,j.REQUEST_FAILED=800220,j.FILE_UPLOAD_CANCEL_FAILED=800230,j.REQUEST_CANCELLED=800240;var Z=function(e){var r,i,s=!1,o=0;e||(e=new Z.WSClientHandler);var l=function(){o=(new Date).getTime()};this.getConnectionState=function(){return 1===r.readyState?ae.getInstance().connectionState.OPEN:ae.getInstance().connectionState.CLOSED};var u=function(){var r,i;this.ping=function(){t&&n.log("PING"),clearTimeout(r),clearTimeout(i),r=setTimeout(function(){var a=Y.bPing();ae.getInstance().wsClient.send(a),i=setTimeout(function(){t&&n.log("PING Timeout"),clearTimeout(r),clearTimeout(i),e.onError()},5e3)},15e3)},this.stop=function(){clearTimeout(r),clearTimeout(i)}},c=new u;this.connect=function(o,u,d){t&&n.log("WSClient connect called"),i=d;var h=null,I=!1;try{h="undefined"==typeof WebSocket?require("websocket").w3cwebsocket:WebSocket}catch(e){h=WebSocket}try{var _="/?p=JS&pv="+encodeURIComponent(a)+"&sv="+encodeURIComponent("3.0.60")+"&ai="+encodeURIComponent(S);if(X.getInstance().sessionKey?_+="&key="+encodeURIComponent(X.getInstance().sessionKey):_+="&user_id="+encodeURIComponent(o)+"&access_token="+encodeURIComponent(u),!(r=new h(i+_)))return void e.onError("ws is not exist.")}catch(n){return void e.onError(n)}if(t)try{window.ws=r}catch(e){}r.onopen=function(r){c&&c.ping(),t&&n.log("WSClient onopen called"),e.onOpen(r)},r.onmessage=function(r){l();var i=r.data.split("\n");for(var a in i){var s=i[a];if(s&&"string"==typeof s){try{if("PONG"===s.substring(0,4)){c&&c.ping();continue}}catch(r){t&&n.log("ws.onmessage-command check error: ",r)}e.onMessage(s)}}},r.onclose=function(r){t&&n.log("WSClient ws.onclose called - e, explicitDisconnect: ",r,s),c&&c.stop(),s?e.onClose(r):I||e.onError(r),s=!1},r.onerror=function(r){t&&n.log("WSClient ws.onerror called: ",r),c&&c.stop(),I=!0,e.onError(r)}},this.disconnect=function(i,a){t&&n.log("WSClient disconnect called [explicit]: ",i),c&&c.stop(),c=null,s=!0===i,r&&(r.onopen=function(){},r.onmessage=function(){},r.onclose=function(){a&&a()},r.onerror=function(){},r.close(),r=null),s?e.onClose():e.onError(),s=!1},this.send=function(e,n){1!==r.readyState?n&&n(null,new _("Connection is not valid. Please reconnect.",j.WEBSOCKET_CONNECTION_CLOSED)):(r.send(e.encode()),n&&n(null,null))}};Z.WSClientHandler=function(){this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}};var X=function(){var e=X.getInstance();if(e)return e;this.sessionKey;var n=0;this.getMessageChangeLogsByToken=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(n));var a={};t&&(a.token=t),u(i,a,r)},this.setChannelInvitationPreference=function(e,n,t){var r=X.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(e));I(r,{auto_accept:n},t)},this.getChannelInvitationPreference=function(e,n){var t=X.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(e));u(t,n)},this.getGroupChannelCount=function(e,n,t){var r=X.API_USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(e)),i="";i=n===w.memberState.JOINED?"joined":n===w.memberState.INVITED?"invited":n===w.memberState.INVITED_BY_FRIEND?"invited_by_friend":n===w.memberState.INVITED_BY_NON_FRIEND?"invited_by_non_friend":"all",u(r,{state:i},t)},this.getTotalUnreadMessageCount=function(e,n,t){var r=X.API_USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(e)),i=null;null!==n&&n.length>0&&(i=l(n)),u(r,null===i?{}:{custom_types:i},t)},this.getTotalUnreadChannelCount=function(e,n){var t=X.API_USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(e));u(t,n)},this.checkRouting=function(e){if(ae.getInstance()&&ae.getInstance().customApiHost&&ae.getInstance().customWsHost)"function"==typeof e&&e({API_HOST:ae.getInstance().customApiHost,WS_HOST:ae.getInstance().customWsHost});else{var t=(new Date).getTime()/1e3;0===n||n-t>300?C(X.API_ROUTING_URL.replace("%s",S),{},"GET",{SendBird:o+S},function(a,s){if(s)return void e(null,new _("Server is unreachable.",j.NETWORK_ROUTING_ERROR));r=a.ws_server,i=a.api_server,n=t,"function"==typeof e&&e({API_HOST:i,WS_HOST:r})}):e({API_HOST:ae.getInstance().getCurrentApiHost(),WS_HOST:ae.getInstance().getCurrentWsHost()},null)}};var t=function(e,n,t,r,i,a,l,u,d,h){if(!ae.getInstance().hasLoggedIn())return void(l&&l(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));X.getInstance().checkRouting(function(n,I){if(I)l(null,new _("Request failed.",j.REQUEST_FAILED));else{var p=N();p.open("POST",n.API_HOST+e,!0),p.setRequestHeader("SendBird",o+S),p.setRequestHeader("Session-Key",X.getInstance().sessionKey);var E=s?new s:new FormData;r&&"undefined"!=typeof Blob?E.append("file",new Blob([t],{type:r}),t.name):E.append("file",t,t.name),a&&E.append("channel_url",a);for(var f in i){var A=parseInt(f)+1;E.append("thumbnail"+A,i[f].maxWidth+","+i[f].maxHeight)}p.onload=function(){d&&d[h]&&delete d[h];p.status>=200&&p.status<400?c(null,JSON.parse(p.responseText),l):c({status:p.status,statusText:p.statusText,response:p.responseText},null,l)},p.onerror=function(e){d&&d[h]&&delete d[h],l(null,new _(p.statusText,j.REQUEST_FAILED))},p.onabort=function(e){d&&d[h]&&delete d[h],l(null,new _("File upload has been cancelled.",j.REQUEST_CANCELLED))},p.upload.onprogress=function(e){e.lengthComputable&&e.loaded>=e.total&&d&&d[h]&&delete d[h],u&&u(e)},E.oldIE?(p.setRequestHeader("Content-Type","multipart/form-data; boundary="+E.boundary),p.send(E.toString())):p.send(E),d&&(d[h]=p)}})},a=function(e,n,t){if("function"==typeof n&&(t=n,n={}),!ae.getInstance().hasLoggedIn())return void(t&&t(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));X.getInstance().checkRouting(function(r,i){i?t(null,new _("Request failed.",j.REQUEST_FAILED)):C(r.API_HOST+e,n,"DELETE",{"Session-Key":X.getInstance().sessionKey,SendBird:o+S},t)})},l=function(e){var n="";for(var t in e)e.hasOwnProperty(t)&&(n+=encodeURIComponent(e[t])+",");return n.length>1&&(n=n.substring(0,n.length-1)),n},u=function(e,n,t){if("function"==typeof n&&(t=n,n={}),!ae.getInstance().hasLoggedIn())return void(t&&t(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));var r,i="";if(n){for(var a in n)""!==i&&(i+="&"),i+=a+"="+n[a];r=e+"?"+i}else r=e;X.getInstance().checkRouting(function(e,i){i?t(null,new _("Request failed.",j.REQUEST_FAILED)):C(e.API_HOST+r,n,"GET",{"Session-Key":X.getInstance().sessionKey,SendBird:o+S},t)})},h=function(e,n,t){if("function"==typeof n&&(t=n,n={}),!ae.getInstance().hasLoggedIn())return void(t&&t(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));X.getInstance().checkRouting(function(r,i){i?t(null,i):C(r.API_HOST+e,n,"POST",{"Session-Key":X.getInstance().sessionKey,SendBird:o+S},t)})},I=function(e,n,t){if("function"==typeof n&&(t=n,n={}),!ae.getInstance().hasLoggedIn())return void(t&&t(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));X.getInstance().checkRouting(function(r,i){i||C(r.API_HOST+e,n,"PUT",{"Session-Key":X.getInstance().sessionKey,SendBird:o+S},t)})};this.addFriends=function(e,n,t){var r=X.API_FRIENDS.replace("%s",encodeURIComponent(e));h(r,{user_ids:n},t)},this.deleteFriends=function(e,n,t){var r=X.API_FRIENDS.replace("%s",encodeURIComponent(e));n.length>0&&(r+="?user_ids=",n.forEach(function(e){r+=encodeURIComponent(e)+","}),r=r.substring(0,r.length-1)),a(r,{},t)},this.deleteFriendDiscoveries=function(e,n,t){var r=X.API_FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(e));n.length>0&&(r+="?friend_discovery_keys=",n.forEach(function(e){r+=encodeURIComponent(e)+","}),r=r.substring(0,r.length-1)),a(r,{},t)},this.uploadFriendDiscoveries=function(e,n,t){var r=X.API_FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(e)),i={friend_discoveries:[]};n.forEach(function(e){i.friend_discoveries.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})}),I(r,i,t)},this.getFriendChangeLogsByToken=function(e,n,t){var r=X.API_FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(e)),i={};n&&(i.token=n),u(r,i,t)},this.friendListQuery=function(e,n,t,r){var i=X.API_FRIENDS.replace("%s",encodeURIComponent(e)),a={limit:t,token:encodeURIComponent(n)};u(i,a,r)},this.createUserMetaData=function(e,n,t){var r=X.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e)),i={};i.metadata=n,h(r,i,t)},this.updateUserMetaData=function(e,n,t,r){var i=X.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e)),a={};a.metadata=n,a.upsert=t,I(i,a,r)},this.deleteAllUserMetaData=function(e,n){var t=X.API_USERS_USERID_METADATA.replace("%s",encodeURIComponent(e));a(t,{},n)},this.deleteUserMetaData=function(e,n,t){var r=X.API_USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(r,{},t)},this.resetMyHistory=function(e,n){var t=X.API_GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(e));I(t,{},n)},this.groupChannelInvite=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(e)),i={},a=[];try{Array.isArray(n)?a=n:a.push(n)}catch(e){t(null,new _("Invalid parameter.",j.INVALID_PARAMETER))}i.user_ids=a,h(r,i,t)},this.acceptInvitation=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(e)),i={};i.user_id=n,I(r,i,t)},this.declineInvitation=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(e)),i={};i.user_id=n,I(r,i,t)},this.groupChannelHide=function(e,n,t,r){var i=X.API_GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(e)),a={};a.user_id=n,a.hide_previous_messages=t,I(i,a,r)},this.publicGroupChannelJoin=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(e)),i={};i.user_id=n,I(r,i,t)},this.groupChannelLeave=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(e)),i={};i.user_id=n,I(r,i,t)},this.groupChannelMarkAsRead=function(e,n,t){var r=X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD.replace("%s",encodeURIComponent(e)),i={};i.user_id=n,I(r,i,t)},this.groupChannelMarkAsReadAll=function(e,n,t){var r=X.API_USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(e)),i={};n&&(i.channel_urls=n),I(r,i,t)},this.messageList=function(e,n,t,r,i,a,s,o,l,c){var d;d=e?String(X.API_OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",n)):String(X.API_GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",n));var h={};h.is_sdk=String(!0),h.message_ts=String(t),h.prev_limit=String(r),h.next_limit=String(i),h.include=String(a),h.reverse=String(s),o&&(h.message_type=String(o)),l&&(h.custom_type=String(l)),u(d,h,c)},this.messageListByID=function(e,n,t,r,i,a,s,o,l,c){var d;d=e?String(X.API_OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",n)):String(X.API_GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",n));var h={};h.is_sdk=String(!0),h.message_id=t,h.prev_limit=String(r),h.next_limit=String(i),h.include=String(a),h.reverse=String(s),o&&(h.message_type=String(o)),l&&(h.custom_type=String(l)),u(d,h,c)},this.login=function(e,n,t){var r=X.API_USERS_USERID_LOGIN.replace("%s",encodeURIComponent(e)),i={};i.app_id=S,n&&(i.access_token=n),h(r,i,function(e,n){n?t(null,n):(X.getInstance().sessionKey=e.key,X.getInstance().ekey=e.ekey,t(e,n))})},this.updateUserInfo=function(e,n,t,r){var i={};n&&(i.nickname=n),t&&(i.profile_url=t);var a=String(X.API_USERS_USERID).replace("%s",encodeURIComponent(e));I(a,i,r)},this.updateCurrentUserInfoWithFile=function(e,n,t,r){if("string"==typeof t)this.updateUserInfo(e,n,t,r);else{var i=s?new s:new FormData;i.append("nickname",n),i.append("profile_file",t,t.name);var a=String(X.API_USERS_USERID).replace("%s",encodeURIComponent(e));I(a,i,r)}},this.getGroupChannel=function(e,n,t,r){var i=X.API_GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)),a={member:String(n),read_receipt:String(t)};u(i,a,r)},this.getOpenChannel=function(e,n){var t=X.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e));u(t,n)},this.createGroupChannel=function(e,n,t,r,i,a,o,l,u,c,d){var I=X.API_GROUPCHANNELS,_=[];"string"==typeof e?_.push(e):e.forEach(function(e){_.push(e)});var p,E=_.filter(function(e,n){return _.indexOf(e)===n}),f=l.isPublic,A=l.channelUrl;r&&"string"!=typeof r?(p=s?new s:new FormData,r&&p.append("cover_file",r,r.name),p.append("user_ids",E),null!==A&&p.append("channel_url",A),null!==n&&p.append("is_distinct",n),null!==o&&p.append("is_super",o),null!==f&&p.append("is_public",f),null!==c&&p.append("is_ephemeral",c),null!==t&&"string"==typeof t&&p.append("name",t),i&&p.append("data",i),a&&p.append("custom_type",a),Array.isArray(u)&&u.length>0&&p.append("operator_ids",u)):(p={},null!==r&&"string"==typeof r&&(p.cover_url=r),p.user_ids=E,null!==A&&(p.channel_url=A),null!==n&&(p.is_distinct=n),null!==o&&(p.is_super=o),null!==f&&(p.is_public=f),null!==c&&(p.is_ephemeral=c),null!==t&&"string"==typeof t&&(p.name=t),i&&(p.data=i),a&&(p.custom_type=a),Array.isArray(u)&&u.length>0&&(p.operator_ids=u)),h(I,p,d)},this.createOpenChannel=function(e,n,t,r,i,a){var o,l=String(X.API_OPENCHANNELS);n&&"string"!=typeof n?(o=s?new s:new FormData,n&&o.append("cover_file",n,n.name),null!==e&&"string"==typeof e&&o.append("name",e),t&&o.append("data",t),r&&(Array.isArray(r)?o.append("operators",r):o.append("operators",[r])),i&&o.append("custom_type",i)):(o={},null!==n&&"string"==typeof n&&(o.cover_url=n),null!==e&&"string"==typeof e&&(o.name=e),t&&(o.data=t),r&&(Array.isArray(r)?o.operators=r:o.operators=[r]),i&&(o.custom_type=i)),h(l,o,a)},this.updateGroupChannel=function(e,n,t,r,i,a,o,l){var u,c=String(X.API_GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));r&&"string"!=typeof r?(u=s?new s:new FormData,null!==n&&u.append("is_distinct",n),null!==o&&u.append("is_public",o),r&&u.append("cover_file",r,r.name),null!==t&&"string"==typeof t&&u.append("name",t),null!==i&&"string"==typeof i&&u.append("data",i),null!==a&&"string"==typeof a&&u.append("custom_type",a)):(u={},null!==n&&(u.is_distinct=n),null!==o&&(u.is_public=o),null!==r&&"string"==typeof r&&(u.cover_url=r),null!==t&&"string"==typeof t&&(u.name=t),null!==i&&"string"==typeof i&&(u.data=i),null!==a&&"string"==typeof a&&(u.custom_type=a)),I(c,u,l)},this.updateOpenChannel=function(e,n,t,r,i,a,o){var l,u=String(X.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));t&&"string"!=typeof t?(l=s?new s:new FormData,t&&l.append("cover_file",t,t.name),null!==n&&"string"==typeof n&&l.append("name",n),null!==r&&"string"==typeof r&&l.append("data",r),null!==i&&(Array.isArray(i)?l.append("operators",i):l.append("operators",[i])),null!==a&&"string"==typeof a&&l.append("custom_type",a)):(l={},null!==t&&"string"==typeof t&&(l.cover_url=t),null!==n&&"string"==typeof n&&(l.name=n),null!==r&&"string"==typeof r&&(l.data=r),null!==i&&(Array.isArray(i)?l.operators=i:l.operators=[i]),null!==a&&"string"==typeof a&&(l.custom_type=a)),I(u,l,o)},this.deleteOpenChannel=function(e,n){var t=String(X.API_OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(e)));a(t,{},n)},this.createMetaCounters=function(e,n,t,r){var i;i=e?X.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var a={};a.metacounter=t,h(i,a,r)},this.updateMetaCounters=function(e,n,t,r,i,a){var s;s=e?X.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var o={};switch(o.metacounter=t,o.upsert=r,i){case X.UPDATE_META_COUNTER_MODE_SET:o.mode="set";break;case X.UPDATE_META_COUNTER_MODE_INC:o.mode="increase";break;case X.UPDATE_META_COUNTER_MODE_DEC:o.mode="decrease"}I(s,o,a)},this.getAllMetaCounters=function(e,n,t){this.getMetaCounters(e,n,{},t)},this.getMetaCounters=function(e,n,t,r){var i;i=e?X.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n));var a=l(t);u(i,{keys:a},r)},this.deleteMetaCounter=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t):X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t),a(i,{},r)},this.deleteAllMetaCounters=function(e,n,t){var r="";r=e?X.API_OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(n)),a(r,{},t)},this.createMetaData=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var a={},s={};for(var o in t){var l=t[o];s[o]=l}a.metadata=s,h(i,a,r)},this.updateMetaData=function(e,n,t,r,i){var a="";a=e?X.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var s={},o={};for(var l in t){var u=t[l];o[l]=u}s.metadata=o,s.upsert=r,I(a,s,i)},this.getAllMetaData=function(e,n,t){this.getMetaData(e,n,{},t)},this.getMetaData=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n));var a=l(t);u(i,{keys:a},r)},this.deleteMetaData=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t):X.API_GROUPCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(n)).replace("%s",t),a(i,{},r)},this.deleteAllMetaData=function(e,n,t){var r="";r=e?X.API_OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)):X.API_GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(n)),a(r,{},t)},this.loadUserList=function(e,n,t,r,i,a){var s=X.API_USERS,o={token:encodeURIComponent(e),limit:String(n)};if(!d(t))try{var l="";for(var c in t){var h=t[c];l+=encodeURIComponent(h)+","}l.length>1&&(l=l.substring(0,l.length-1)),o.user_ids=l}catch(e){}if(r&&!d(i)){var I="";i.forEach(function(e){I+=encodeURIComponent(e)+","}),I.length>0&&(I=I.substring(0,I.length-1)),o.metadatakey=encodeURIComponent(r),o.metadatavalues_in=I}u(s,o,a)},this.loadBlockedUserList=function(e,n,t,r){
var i=X.API_USERS_USERID_BLOCK.replace("%s",encodeURIComponent(e)),a={token:encodeURIComponent(n),limit:String(t)};u(i,a,r)},this.loadOpenChannelList=function(e,n,t,r,i,a){var s=X.API_OPENCHANNELS,o={token:encodeURIComponent(e),limit:String(n)};null!==t&&(o.name_contains=encodeURIComponent(t)),r&&(o.url_contains=encodeURIComponent(r)),null!==i&&(o.custom_type=encodeURIComponent(i)),u(s,o,a)},this.uploadFile=function(e,n,r,i,a,s,o,l){t(X.API_STORAGE_FILE,0,e,n,r,i,a,s,o,l)},this.uploadProfileImage=function(e,n){t(X.API_STORAGE_PROFILE,0,e,"",[],"",n)},this.loadOperatorList=function(e,n,t,r,i){var a=n?X.API_OPENCHANNELS_OPERATORS.replace("%url",encodeURIComponent(e)):X.API_GROUPCHANNELS_OPERATORS.replace("%url",encodeURIComponent(e)),s={token:encodeURIComponent(t),limit:r};u(a,s,i)},this.loadGroupChannelMemberList=function(e,n,t,r,i,a){var s=X.API_GROUPCHANNELS_MEMBERS.replace("%url",encodeURIComponent(e)),o={token:encodeURIComponent(n),limit:t,muted_member_filter:r.toLowerCase(),operator_filter:i.toLowerCase()};u(s,o,a)},this.loadPublicGroupChannelList=function(e,n,t,r,i,a,s,o,l,c,d){var h=X.API_GROUPCHANNELS,I={public_mode:w.publicChannelFilter.PUBLIC,token:encodeURIComponent(e),limit:String(n),show_member:!0,show_read_receipt:!0,show_empty:String(t),order:r};if(i)try{I.name_contains=encodeURIComponent(i)}catch(e){}if(a.length>0)try{I.channel_urls=a.map(function(e){return encodeURIComponent(e)}).join(",")}catch(e){}if(s.length>0){var _="";s.forEach(function(e){_+=encodeURIComponent(e)+","}),_=_.substring(0,_.length-1),I.custom_types=_}o&&(I.custom_type_startswith=o),I.super_mode=l,I.public_membership_mode=c,u(h,I,d)},this.loadUserGroupChannelList=function(e,n,t,r,i,a,s,o,c,d,h,I,_,p,E,f){var A=X.API_MYGROUPCHANNELS.replace("%s",encodeURIComponent(e)),g=a.userIds,m=!a.includeMode,v=a.queryType,N={token:encodeURIComponent(n),limit:String(t),show_member:!0,show_read_receipt:!0,show_empty:String(r),order:i,member_state_filter:_};if(h.length>0){var C="";h.forEach(function(e){C+=encodeURIComponent(e)+","}),C=C.substring(0,C.length-1),N.custom_types=C}else d&&(N.custom_type=encodeURIComponent(d));if(s)try{N.members_nickname_contains=encodeURIComponent(s)}catch(e){}if(o)try{N.name_contains=encodeURIComponent(o)}catch(e){}if(g.length>0)try{m?N.members_exactly_in=l(g):(N.members_include_in=l(g),N.query_type=v)}catch(e){}if(c.length>0)try{N.channel_urls=c.map(function(e){return encodeURIComponent(e)}).join(",")}catch(e){}N.super_mode=p,N.public_mode=E,I&&(N.custom_type_startswith=I),u(A,N,f)},this.loadOpenChannelParticipantList=function(e,n,t,r){var i=X.API_OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",e),a={token:encodeURIComponent(n),limit:String(t)};u(i,a,r)},this.loadMutedUserList=function(e,n,t,r){var i=e.isOpenChannel()?X.API_OPENCHANNELS_CHANNELURL_MUTE.replace("%s",e.url):X.API_GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",e.url),a={token:encodeURIComponent(n),limit:String(t)};u(i,a,r)},this.loadBannedUserList=function(e,n,t,r){var i=e.isOpenChannel()?X.API_OPENCHANNELS_CHANNELURL_BAN.replace("%s",e.url):X.API_GROUPCHANNELS_CHANNELURL_BAN.replace("%s",e.url),a={token:encodeURIComponent(n),limit:String(t)};u(i,a,r)},this.setPushTemplate=function(e,n,t){var r=X.API_USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(e));I(r,{name:n},t)},this.getPushTemplate=function(e,n){var t=X.API_USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(e));u(t,n)},this.setDoNotDisturb=function(e,n,t,r,i,a,s,o){var l=X.API_USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(e));I(l,{do_not_disturb:n,start_hour:t,start_min:r,end_hour:i,end_min:a,timezone:s},o)},this.getDoNotDisturb=function(e,n){var t=X.API_USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(e));u(t,n)},this.setPushPreference=function(e,n,t,r){var i=X.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)),a={};a.enable=t,I(i,a,r)},this.getPushPreference=function(e,n,t){var r=X.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));u(r,t)},this.registerGCMPushToken=function(e,n,t){var r=X.API_USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(e));h(r,{gcm_reg_token:n},t)},this.unregisterGCMPushToken=function(e,n,t){var r=X.API_USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(r,t)},this.unregisterGCMPushTokenAll=function(e,n){var t=X.API_USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(e));a(t,n)},this.registerAPNSPushToken=function(e,n,t){var r=X.API_USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(e));h(r,{apns_device_token:n},t)},this.unregisterAPNSPushToken=function(e,n,t){var r=X.API_USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(r,t)},this.unregisterAPNSPushTokenAll=function(e,n){var t=X.API_USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(e));a(t,n)},this.unregisterPushTokenAll=function(e,n){var t=X.API_USERS_USERID_PUSH.replace("%s",encodeURIComponent(e));a(t,n)},this.blockUser=function(e,n,t){var r=X.API_USERS_USERID_BLOCK.replace("%s",encodeURIComponent(e));h(r,{target_id:n},t)},this.unblockUser=function(e,n,t){var r=X.API_USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(r,{},t)},this.banUser=function(e,n,t,r,i,a){var s=i?X.API_GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(e)):X.API_OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(e)),o={user_id:n};t&&(o.description=t),o.seconds=String(r),h(s,o,a)},this.unbanUser=function(e,n,t,r){var i=t?X.API_GROUPCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)):X.API_OPENCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(i,{},r)},this.muteUser=function(e,n,t,r){var i=t?X.API_GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(e)):X.API_OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(e));h(i,{user_id:n},r)},this.unmuteUser=function(e,n,t,r){var i=t?X.API_GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n)):X.API_OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(e)).replace("%s",encodeURIComponent(n));a(i,{},r)},this.deleteMessage=function(e,n,t,r){var i="";i=e?X.API_OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(n)).replace("%s",encodeURIComponent(t)):X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(n)).replace("%s",encodeURIComponent(t)),a(i,{},r)},this.freeze=function(e,n,t,r){var i=n?X.API_GROUPCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(e)):X.API_OPENCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(e));I(i,{freeze:t},r)}},$=null;X.getInstance=function(){return null===$?null:$},X.API_VERSION="v3",X.API_ROUTING_URL="https://api-p.sendbird.com/routing/%s",X.API_USERS="/%v/users".replace("%v",X.API_VERSION),X.API_USERS_USERID_LOGIN="/%v/users/%s/login".replace("%v",X.API_VERSION),X.API_USERS_USERID="/%v/users/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_METADATA="/%v/users/%s/metadata".replace("%v",X.API_VERSION),X.API_USERS_USERID_METADATA_KEY="/%v/users/%s/metadata/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_UNREAD_MESSAGE_COUNT="/%v/users/%s/unread_message_count".replace("%v",X.API_VERSION),X.API_USERS_USERID_UNREAD_CHANNEL_COUNT="/%v/users/%s/unread_channel_count".replace("%v",X.API_VERSION),X.API_USERS_USERID_MARKASREADALL="/%v/users/%s/mark_as_read_all".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH_GCM_TOKEN="/%v/users/%s/push/gcm/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH_GCM="/%v/users/%s/push/gcm".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSHPREFERENCE_CHANNELURL="/%v/users/%s/push_preference/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSHPREFERENCE="/%v/users/%s/push_preference/".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH_TEMPLATE="/%v/users/%s/push/template".replace("%v",X.API_VERSION),X.API_USERS_USERID_BLOCK="/%v/users/%s/block".replace("%v",X.API_VERSION),X.API_USERS_USERID_BLOCK_TARGETID="/%v/users/%s/block/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH_APNS_TOKEN="/%v/users/%s/push/apns/%s".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH_APNS="/%v/users/%s/push/apns".replace("%v",X.API_VERSION),X.API_USERS_USERID_PUSH="/%v/users/%s/push".replace("%v",X.API_VERSION),X.API_USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE="/%v/users/%s/channel_invitation_preference".replace("%v",X.API_VERSION),X.API_USERS_USERID_GROUP_CHANNEL_COUNT="/%v/users/%s/group_channel_count".replace("%v",X.API_VERSION),X.API_OPENCHANNELS="/%v/open_channels".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL="/%v/open_channels/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_MESSAGES="/%v/open_channels/%s/messages".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID="/%v/open_channels/%s/messages/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_PARTICIPANTS="/%v/open_channels/%s/participants".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_METADATA="/%v/open_channels/%s/metadata".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_METADATA_KEY="/%v/open_channels/%s/metadata/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_METACOUNTER="/%v/open_channels/%s/metacounter".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_METACOUNTER_KEY="/%v/open_channels/%s/metacounter/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_BAN="/%v/open_channels/%s/ban".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_BAN_USERID="/%v/open_channels/%s/ban/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_MUTE="/%v/open_channels/%s/mute".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_MUTE_USERID="/%v/open_channels/%s/mute/%s".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_FREEZE="/%v/open_channels/%s/freeze".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS="/%v/group_channels".replace("%v",X.API_VERSION),X.API_MYGROUPCHANNELS="/%v/users/%s/my_group_channels".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL="/%v/group_channels/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_INVITE="/%v/group_channels/%s/invite".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION="/%v/group_channels/%s/accept".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION="/%v/group_channels/%s/decline".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_HIDE="/%v/group_channels/%s/hide".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_LEAVE="/%v/group_channels/%s/leave".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_JOIN="/%v/group_channels/%s/join".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES="/%v/group_channels/%s/messages".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD="/%v/group_channels/%s/messages/mark_as_read".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT="/%v/group_channels/%s/messages/total_count".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT="/%v/group_channels/%s/messages/unread_count".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID="/%v/group_channels/%s/messages/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MEMBERS="/%v/group_channels/%s/members".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_METADATA="/%v/group_channels/%s/metadata".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_METADATA_KEY="/%v/group_channels/%s/metadata/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER="/%v/group_channels/%s/metacounter".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY="/%v/group_channels/%s/metacounter/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_RESET_USER_HISTORY="/%v/group_channels/%s/reset_user_history".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_MEMBERS="/%v/group_channels/%url/members".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_BAN="/%v/group_channels/%s/ban".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_BAN_USERID="/%v/group_channels/%s/ban/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MUTE="/%v/group_channels/%s/mute".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MUTE_USERID="/%v/group_channels/%s/mute/%s".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_FREEZE="/%v/group_channels/%s/freeze".replace("%v",X.API_VERSION),X.API_STORAGE_FILE="/%v/storage/file".replace("%v",X.API_VERSION),X.API_STORAGE_PROFILE="/%v/storage/profile_image".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS="/%v/open_channels/%s/messages/changelogs".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS="/%v/group_channels/%s/messages/changelogs".replace("%v",X.API_VERSION),X.API_FRIENDS="/%v/users/%s/friends".replace("%v",X.API_VERSION),X.API_FRIENDS_CHANGE_LOGS="/%v/users/%s/friends/changelogs".replace("%v",X.API_VERSION),X.API_FRIENDS_DISCOVERIES="/%v/users/%s/friend_discoveries".replace("%v",X.API_VERSION),X.API_GROUPCHANNELS_OPERATORS="/%v/group_channels/%url/operators".replace("%v",X.API_VERSION),X.API_OPENCHANNELS_OPERATORS="/%v/open_channels/%url/operators".replace("%v",X.API_VERSION),X.UPDATE_META_COUNTER_MODE_SET=0,X.UPDATE_META_COUNTER_MODE_INC=1,X.UPDATE_META_COUNTER_MODE_DEC=2;var ee=function(){var e="";this.isLoading=!1,this.hasMore=!0,this.limit=20;var n=this;this.next=function(t){if(!h(n.limit))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),t);if(n.hasMore){if(n.isLoading)return void U(null,new _("Query in progress.",j.QUERY_IN_PROGRESS),t);n.isLoading=!0,X.getInstance().friendListQuery(ae.getInstance().getCurrentUserId(),e,n.limit,function(r,i){if(i)return n.isLoading=!1,void U(null,i,t);var a=r.users,s=a.map(function(e){return new G(e)});n.hasMore=r.has_more,n.isLoading=!1,e=r.next,U(s,null,t)})}}},ne=function(e,n,t,r){u?this[t]=e[n]:Object.defineProperty(e,t,{get:function(){return"_coverUrl"===n||"_coverImage"===n?e._channelCover:e[n]},set:function(t){if("file"===r){if("string"==typeof t||"object"!=typeof t)throw new _("Invalid parameter.",j.INVALID_PARAMETER)}else if(r&&typeof t!==r)throw new _("Invalid parameter.",j.INVALID_PARAMETER);e[n]=t,"_coverUrl"!==n&&"_coverImage"!==n||(e._channelCover=t)}})},te=function(){this._isDistinct=null,ne(this,"_isDistinct","isDistinct","boolean"),this._isSuper=null,ne(this,"_isSuper","isSuper","boolean"),this._isPublic=null,ne(this,"_isPublic","isPublic","boolean"),this._channelUrl=null,ne(this,"_channelUrl","channelUrl","string"),this._name=null,ne(this,"_name","name","string"),this._data=null,ne(this,"_data","data","string"),this._customType=null,ne(this,"_customType","customType","string"),this._channelCover=null,ne(this,"_channelCover","channelCover",null),this._coverUrl=null,ne(this,"_coverUrl","coverUrl","string"),this._coverImage=null,ne(this,"_coverImage","coverImage","file"),this._operatorIds=[],this._operators=null,u?this.operators=this._operators:Object.defineProperty(this,"operators",{get:function(){return this._operators},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new _("Invalid parameter.",j.INVALID_PARAMETER);n.push(e[t].userId)}this._operatorIds=n}}),this._operatorUserIds=null,u?this.operatorUserIds=this._operatorUserIds:Object.defineProperty(this,"operatorUserIds",{get:function(){return this._operatorUserIds},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if("string"!=typeof e[t])throw n=[],new _("Invalid parameter.",j.INVALID_PARAMETER);n.push(e[t])}this._operatorIds=n}}),this._isEphemeral=null,ne(this,"_isEphemeral","isEphemeral","boolean"),this._inviteUserIds=[],this.addUsers=function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=e.length,t=[],r=0;r<n;r++){if(!e[r].hasOwnProperty("userId"))throw t=[],new _("Invalid parameter.",j.INVALID_PARAMETER);t.push(e[r].userId)}this._inviteUserIds=this._inviteUserIds.concat(t)},this.addUser=function(e){if(!e.hasOwnProperty("userId"))throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._inviteUserIds.push(e.userId)},this.addUserIds=function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=e.length,t=[],r=0;r<n;r++){if("string"!=typeof e[r])throw t=[],new _("Invalid parameter.",j.INVALID_PARAMETER);t.push(e[r])}this._inviteUserIds=this._inviteUserIds.concat(t)},this.addUserId=function(e){if("string"!=typeof e)throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._inviteUserIds.push(e)}},re=function(){this._message=null,ne(this,"_message","message","string"),this._targetLanguages=null,u?this.targetLanguages=this._targetLanguages:Object.defineProperty(this,"targetLanguages",{get:function(){return this._targetLanguages},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("string"!=typeof e[n])throw this._targetLanguages=[],new _("Invalid parameter.",j.INVALID_PARAMETER);this._targetLanguages=e}}),this._data=null,ne(this,"_data","data","string"),this._customType=null,ne(this,"_customType","customType","string"),this._mentionedIds=[],this._mentionedUsers=null,u?this.mentionedUsers=this._mentionedUsers:Object.defineProperty(this,"mentionedUsers",{get:function(){return this._mentionedUsers},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new _("Invalid parameter.",j.INVALID_PARAMETER);n.push(e[t].userId)}this._mentionedIds=n}}),this._mentionedUserIds=null,u?this.mentionedUserIds=this._mentionedUserIds:Object.defineProperty(this,"mentionedUserIds",{get:function(){return this._mentionedUserIds},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("string"!=typeof e[n])throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._mentionedIds=e}}),this._pushNotificationDeliveryOption=null,ne(this,"_pushNotificationDeliveryOption","pushNotificationDeliveryOption","string")};re.PushNotificationDeliveryOption={DEFAULT:"default",SUPPRESS:"suppress"};var ie=function(){this._file=null,u?this.file=this._file:Object.defineProperty(this,"file",{get:function(){return this._file},set:function(e){if("string"==typeof e||"object"!=typeof e)throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._fileUrl=null,this._file=e}}),this._fileUrl=null,u?this.fileUrl=this._fileUrl:Object.defineProperty(this,"fileUrl",{get:function(){return this._fileUrl},set:function(e){if("string"!=typeof e)throw new _("Invalid parameter.",j.INVALID_PARAMETER);this._file=null,this._fileUrl=e}}),this._thumbnailSizes=null,u?this.thumbnailSizes=this._thumbnailSizes:Object.defineProperty(this,"thumbnailSizes",{get:function(){return this._thumbnailSizes},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=0;n<e.length;n++)if("object"!=typeof e[n]||"number"!=typeof e[n].maxWidth||"number"!=typeof e[n].maxHeight)throw this._thumbnailSizes=[],new _("Invalid parameter.",j.INVALID_PARAMETER);this._thumbnailSizes=e}}),this._fileName=null,ne(this,"_fileName","fileName","string"),this._mimeType=null,ne(this,"_mimeType","mimeType","string"),this._fileSize=null,ne(this,"_fileSize","fileSize","number"),this._data=null,ne(this,"_data","data","string"),this._customType=null,ne(this,"_customType","customType","string"),this._mentionedIds=[],this._mentionedUsers=null,u?this.mentionedUsers=this._mentionedUsers:Object.defineProperty(this,"mentionedUsers",{get:function(){return this._mentionedUsers},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if(!e[t].hasOwnProperty("userId"))throw n=[],new _("Invalid parameter.",j.INVALID_PARAMETER);n.push(e[t].userId)}this._mentionedIds=n}}),this._mentionedUserIds=null,u?this.mentionedUserIds=this._mentionedUserIds:Object.defineProperty(this,"mentionedUserIds",{get:function(){return this._mentionedUserIds},set:function(e){if(!Array.isArray(e))throw new _("Invalid parameter.",j.INVALID_PARAMETER);for(var n=[],t=0;t<e.length;t++){if("string"!=typeof e[t])throw n=[],new _("Invalid parameter.",j.INVALID_PARAMETER);n.push(e[t])}this._mentionedIds=n}}),this._pushNotificationDeliveryOption=null,ne(this,"_pushNotificationDeliveryOption","pushNotificationDeliveryOption","string")};ie.PushNotificationDeliveryOption={DEFAULT:"default",SUPPRESS:"suppress"};var ae=function(e){var a=ae.getInstance();if(a)return a;try{if(!e.hasOwnProperty("appId"))return n.log("Must be set appId"),{}}catch(e){return n.log("Must be set appId"),{}}this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.isSessionOpened=!1,this.pushTokenRegistrationState={SUCCESS:"success",PENDING:"pending",ERROR:"error"},this.loginTimer,this.onLoginTimerCancel,this.globalTimer,this.reconnectTimer,this.onReconnectTimerCancel,this.currentUser=null,this.getCurrentUserId=function(){return ae.getInstance().currentUser?ae.getInstance().currentUser.userId:null},this.wsClient,this.connectionState={CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSING:"CLOSING",CLOSED:"CLOSED"},this.ConnectionState=this.connectionState,this.BaseChannel=p,this.User=G,this.Member=V,this.OpenChannel=b,this.GroupChannel=w,this.UserMessage=O,this.FileMessage=D,this.AdminMessage=L,this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.connectionCallback=[],this.GroupChannelParams=te,this.FileMessageParams=ie,this.UserMessageParams=re;var s={};S=e.appId,se=this,$=X.getInstance(),$||($=new X),this.Options={UseMemberAsMessageSender:!1},this.customApiHost=null,this.customWsHost=null,this.UserEventHandler=function(){this.onFriendsDiscovered=function(e){}},this.addUserEventHandler=function(e,n){ae.getInstance().userEventHandlers[e]=n},this.removeUserEventHandler=function(e){delete ae.getInstance().userEventHandlers[e]},this.removeAllUserEventHandler=function(){ae.getInstance().userEventHandlers={}},this.ChannelHandler=function(){this.onMessageReceived=function(e,n){},this.onMessageUpdated=function(e,n){},this.onMessageDeleted=function(e,n){},this.onReadReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,n){},this.onUserLeft=function(e,n){},this.onUserEntered=function(e,n){},this.onUserExited=function(e,n){},this.onUserMuted=function(e,n){},this.onUserUnmuted=function(e,n){},this.onUserBanned=function(e,n){},this.onUserUnbanned=function(e,n){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e){},this.onUserReceivedInvitation=function(e,n,t){},this.onUserDeclinedInvitation=function(e,n,t){},this.onMetaDataCreated=function(e,n){},this.onMetaDataUpdated=function(e,n){},this.onMetaDataDeleted=function(e,n){},this.onMetaCountersCreated=function(e,n){},this.onMetaCountersUpdated=function(e,n){},this.onMetaCountersDeleted=function(e,n){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,n){}},this.addChannelHandler=function(e,n){ae.getInstance().channelHandlers[e]=n},this.removeChannelHandler=function(e){delete ae.getInstance().channelHandlers[e]},this.removeAllChannelHandlers=function(){ae.getInstance().channelHandlers={}},this.ConnectionHandler=function(){this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}},this.addConnectionHandler=function(e,n){ae.getInstance().connectionHandlers[e]=n},this.removeConnectionHandler=function(e){delete ae.getInstance().connectionHandlers[e]},this.removeAllConnectionHandlers=function(){ae.getInstance().connectionHandlers={}},this.createUserListQuery=function(e){return e?new J(J.FILTERED_USER,e):new J(J.ALL_USER)},this.createBlockedUserListQuery=function(){return new J(J.BLOCKED_USER)},this.getApplicationId=function(){return S},this.getDebugMode=function(){return t},this.setDebugMode=function(e){t=e},this.setAPIHost=function(e){i=e},this.setWSHost=function(e){r=e},this.clearCurrentApiHost=function(){this.customApiHost=null},this.getCurrentApiHost=function(){return this.customApiHost?this.customApiHost:i},this.clearCurrentWsHost=function(){this.customWsHost=null},this.getCurrentWsHost=function(){return this.customWsHost?this.customWsHost:r},this.setErrorFirstCallback=function(e){R=e},this.getConnectionState=function(){if(!ae.getInstance())return this.connectionState.CLOSED;try{return ae.getInstance().wsClient?ae.getInstance().isSessionOpened?ae.getInstance().wsClient.getConnectionState():ae.getInstance().connectionState.CONNECTING:ae.getInstance().connectionState.CLOSED}catch(e){return ae.getInstance().connectionState.CLOSED}},this.hasLoggedIn=function(){return ae.getInstance().currentUser&&X.getInstance().sessionKey};var o=function(e){return s.hasOwnProperty(e)?s[e]:null},l=function(e){var t=new Y(e);if(t.requestId){var r=o(t.requestId);if(null==r)return;clearTimeout(r.timer);var i=r.handler;if(i)if("EROR"===t.command){var a=t.getJsonElement(),s=a.code,l=a.message;i(t,new _(l,s))}else i(t,null)}else switch(t.command){case"LOGI":if(ae.getInstance().loginTimer){clearTimeout(ae.getInstance().loginTimer),ae.getInstance().loginTimer=null,ae.getInstance().onLoginTimerCancel=null;var d=t.getJsonElement();if(d.hasOwnProperty("error")){ae.getInstance().isSessionOpened=!1;var s=d.code,l=d.message;ae.getInstance().loginHandler(null,new _(l,s))}else ae.getInstance().isSessionOpened=!0,d.hasOwnProperty("key")&&(X.getInstance().sessionKey=d.key),d.hasOwnProperty("ekey")&&(X.getInstance().ekey=d.ekey),d.hasOwnProperty("user_id")&&(ae.getInstance().currentUser=new G(d)),ae.getInstance().loginHandler(ae.getInstance().currentUser,null)}break;case"MESG":case"FILE":case"BRDM":case"ADMM":var h="",I=!1;if("MESG"===t.command?h=new O(t.getJsonElement()):"FILE"===t.command?h=new D(t.getJsonElement()):(h=new L(t.getJsonElement()),t.getJsonElement().hasOwnProperty("silent")&&(I=t.getJsonElement().silent)),!h)return;if(h.isGroupChannel()){var p=w.cachedChannels.hasOwnProperty(h.channelUrl);w.getChannel(h.channelUrl,function(e,n){if(R){var t=e;e=n,n=t}if(n)return void(i&&i(null,n));if(e.isHidden=!1,w.cachedChannels[e.url]=e,h._sender&&e.memberMap.hasOwnProperty(h._sender.userId)){var r=e.memberMap[h._sender.userId];r.nickname!==h._sender.nickname&&(r.nickname=h._sender.nickname),r.profileUrl!==h._sender.profileUrl&&(r.profileUrl=h._sender.profileUrl)}var a=ae.getInstance().currentUser;if(a&&h._sender&&a.userId===h._sender.userId&&(a.nickname!==h._sender.nickname&&(a.nickname=h._sender.nickname),a.profileUrl!==h._sender.profileUrl&&(a.profileUrl=h._sender.profileUrl)),I||(e.isEphemeral?(e.lastMessage=h,h.sender&&h.sender.userId===ae.getInstance().getCurrentUserId()||e.unreadMessageCount++):p&&(e.updatedLocal?(e.lastMessage=h,h.sender&&h.sender.userId===ae.getInstance().getCurrentUserId()||e.unreadMessageCount++):(!e.lastMessage||e.lastMessage.createdAt<h.createdAt)&&(e.updatedLocal=!0,e.lastMessage=h,h.sender&&h.sender.userId===ae.getInstance().getCurrentUserId()||e.unreadMessageCount++))),!I)for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onChannelChanged(e)}var l=!1;for(var s in h.mentionedUsers)if(h.mentionedUsers[s].userId===ae.getInstance().getCurrentUserId()){l=!0;break}for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onMessageReceived(e,h),l&&o.onMentionReceived(e,h)}})}else b.getChannel(h.channelUrl,function(e,n){if(R){var t=e;e=n,n=t}if(n)return void(i&&i(null,n));var r=!1;for(var a in h.mentionedUsers)if(h.mentionedUsers[a].userId===ae.getInstance().getCurrentUserId()){r=!0;break}for(var a in ae.getInstance().channelHandlers){var s=ae.getInstance().channelHandlers[a];b.enteredChannels[e.url]&&s.onMessageReceived(e,h),r&&s.onMentionReceived(e,h)}});break;case"MEDI":case"FEDI":case"AEDI":var h="";if(!(h="MEDI"===t.command?new O(t.getJsonElement()):"FEDI"===t.command?new D(t.getJsonElement()):new L(t.getJsonElement())))return;h.isGroupChannel()?w.getChannel(h.channelUrl,function(e,n){if(R){var t=e;e=n,n=t}if(n)return void(i&&i(null,n));if(h._sender&&e.memberMap.hasOwnProperty(h._sender.userId)){var r=e.memberMap[h._sender.userId];r.nickname!==h._sender.nickname&&(r.nickname=h._sender.nickname),r.profileUrl!==h._sender.profileUrl&&(r.profileUrl=h._sender.profileUrl)}var a=ae.getInstance().currentUser;a&&h._sender&&a.userId===h._sender.userId&&(a.nickname!==h._sender.nickname&&(a.nickname=h._sender.nickname),a.profileUrl!==h._sender.profileUrl&&(a.profileUrl=h._sender.profileUrl));for(var s in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[s].onMessageUpdated(e,h)}}):b.getChannel(h.channelUrl,function(e,n){if(R){var t=e;e=n,n=t}if(n)return void(i&&i(null,n));for(var r in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[r].onMessageUpdated(e,h)}});break;case"READ":var E=new F(t.getJsonElement()),p=w.cachedChannels.hasOwnProperty(E.channelUrl);w.getChannel(E.channelUrl,function(e,n){if(R){var t=e;e=n,n=t}if(n)return void(i&&i(null,n));if(E.reader.userId===ae.getInstance().getCurrentUserId()){if(p){if(e.unreadMessageCount>0){e.unreadMessageCount=0;for(var r in ae.getInstance().channelHandlers){var a=ae.getInstance().channelHandlers[r];a.onChannelChanged(e)}}}else if(0===e.unreadMessageCount)for(var r in ae.getInstance().channelHandlers){var a=ae.getInstance().channelHandlers[r];a.onChannelChanged(e)}}else{e.updateReadReceipt(E.reader.userId,E.timestamp);for(var r in ae.getInstance().channelHandlers){var a=ae.getInstance().channelHandlers[r];a.onReadReceiptUpdated(e)}}});break;case"TPST":case"TPEN":case"MTIO":break;case"SYEV":c(t);break;case"USEV":u(t);break;case"DELM":var f=t.getJsonElement(),A=String(f.channel_type),g=String(f.channel_url),m=String(f.msg_id);switch(A){case M.CHANNEL_TYPE_OPEN:b.getChannel(g,function(e,t){if(R){var r=e;e=t,t=r}if(t)return void n.log("Discard a command.");for(var i in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[i].onMessageDeleted(e,m)}});break;case M.CHANNEL_TYPE_GROUP:w.getChannel(g,function(e,t){if(R){var r=e;e=t,t=r}if(t)return void n.log("Discard a command.");for(var i in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[i].onMessageDeleted(e,m)}})}}},u=function(e){var n=new H(e.getJsonElement());switch(n.category){case k.CATEGORY_USER_BLOCK:case k.CATEGORY_USER_UNBLOCK:var t=n.data.blocker.user_id,r=n.data.blockee.user_id;Object.keys(w.cachedChannels).forEach(function(e){var i=w.cachedChannels[e];try{ae.getInstance().getCurrentUserId()===t?i.memberMap[r].isBlockedByMe=n.category===k.CATEGORY_USER_BLOCK:ae.getInstance().getCurrentUserId()===r&&(i.memberMap[t].isBlockingMe=n.category===k.CATEGORY_USER_BLOCK)}catch(e){}});break;case k.CATEGORY_FRIEND_DISCOVERED:var i=n.data.friend_discoveries,a=i.map(function(e){return new G(e)});for(var s in ae.getInstance().userEventHandlers){ae.getInstance().userEventHandlers[s].onFriendsDiscovered(a)}}},c=function(e){var t=new H(e.getJsonElement());switch(t.category){case H.CATEGORY_CHANNEL_JOIN:case H.CATEGORY_CHANNEL_LEAVE:w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);if(t.category===H.CATEGORY_CHANNEL_JOIN){t.data.state=V.JOINED,
r.addMember(new V(t.data)),s.userId===ae.getInstance().getCurrentUserId()&&(r.myMemberState="joined",w.cachedChannels[r.url]=r);for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserJoined(r,s)}}else{s.userId===ae.getInstance().getCurrentUserId()&&(r.isPublic||w.removeCachedChannel(t.channelUrl),r.myMemberState="none"),r.removeMember(s),w.cachedChannels[r.url]=r;for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserLeft(r,s)}}});break;case H.CATEGORY_CHANNEL_INVITE:w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=null;t.data&&t.data.inviter&&!d(t.data.inviter)&&(s=new G(t.data.inviter));var o=[];for(var l in t.data.invitees){t.data.invitees[l].state=V.INVITED;var u=new V(t.data.invitees[l]);o.push(u),r.addMember(u),u.userId===ae.getInstance().getCurrentUserId()&&(r.isHidden=!1,"joined"!==r.myMemberState&&(r.myMemberState="invited"),w.cachedChannels[r.url]=r)}for(var l in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[l].onUserReceivedInvitation(r,s,o)}});break;case H.CATEGORY_CHANNEL_DECLINE_INVITE:w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=null;t.data&&t.data.inviter&&!d(t.data.inviter)&&(s=new G(t.data.inviter));var o=new G(t.data.invitee);o.userId===ae.getInstance().getCurrentUserId()&&(r.myMemberState="none",r.isPublic||w.removeCachedChannel(t.channelUrl)),r.removeMember(o),w.cachedChannels[r.url]=r;for(var l in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[l].onUserDeclinedInvitation(r,s,o)}});break;case H.CATEGORY_TYPING_START:case H.CATEGORY_TYPING_END:w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);t.category===H.CATEGORY_TYPING_START?r.updateTypingStatus(s,!0):r.updateTypingStatus(s,!1);for(var o in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[o].onTypingStatusUpdated(r)}});break;case H.CATEGORY_CHANNEL_ENTER:case H.CATEGORY_CHANNEL_EXIT:b.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);t.data.hasOwnProperty("participant_count")&&(r.participantCount=t.data.participant_count);var s=new G(t.data);if(t.category===H.CATEGORY_CHANNEL_ENTER)for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserEntered(r,s)}else for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserExited(r,s)}});break;case H.CATEGORY_USER_CHANNEL_MUTE:case H.CATEGORY_USER_CHANNEL_UNMUTE:t.isOpenChannel()?b.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);if(t.category===H.CATEGORY_USER_CHANNEL_MUTE)for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserMuted(r,s)}else for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserUnmuted(r,s)}}):w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);if(t.category===H.CATEGORY_USER_CHANNEL_MUTE)for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserMuted(r,s)}else for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserUnmuted(r,s)}});break;case H.CATEGORY_USER_CHANNEL_BAN:case H.CATEGORY_USER_CHANNEL_UNBAN:t.isOpenChannel()?b.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);if(t.category===H.CATEGORY_USER_CHANNEL_BAN)for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserBanned(r,s)}else for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserUnbanned(r,s)}}):w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);var s=new G(t.data);if(t.category===H.CATEGORY_USER_CHANNEL_BAN)for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserBanned(r,s)}else for(var o in ae.getInstance().channelHandlers){var l=ae.getInstance().channelHandlers[o];l.onUserUnbanned(r,s)}});break;case H.CATEGORY_CHANNEL_FREEZE:case H.CATEGORY_CHANNEL_UNFREEZE:t.isOpenChannel()?b.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);if(r.isFrozen=t.data.freeze,b.cachedChannels[r.url]=r,t.category===H.CATEGORY_CHANNEL_FREEZE)for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onChannelFrozen(r)}else for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onChannelUnfrozen(r)}}):w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);if(r.isFrozen=t.data.freeze,w.cachedChannels[r.url]=r,t.category===H.CATEGORY_CHANNEL_FREEZE)for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onChannelFrozen(r)}else for(var s in ae.getInstance().channelHandlers){var o=ae.getInstance().channelHandlers[s];o.onChannelUnfrozen(r)}});break;case H.CATEGORY_CHANNEL_DELETED:if(t.isGroupChannel()){w.removeCachedChannel(t.channelUrl);for(var r in ae.getInstance().channelHandlers){var i=ae.getInstance().channelHandlers[r];i.onChannelDeleted(t.channelUrl,"group")}}else{b.removeCachedChannel(t.channelUrl);for(var r in ae.getInstance().channelHandlers){var i=ae.getInstance().channelHandlers[r];i.onChannelDeleted(t.channelUrl,"open")}}break;case H.CATEGORY_CHANNEL_PROP_CHANGED:t.isOpenChannel()?b.getChannelWithoutCache(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);for(var s in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[s].onChannelChanged(r)}}):w.getChannelWithoutCache(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);for(var s in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[s].onChannelChanged(r)}});break;case H.CATEGORY_CHANNEL_META_DATA_CHANGED:case H.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var a=t.data.hasOwnProperty("created"),s=t.data.hasOwnProperty("updated"),o=t.data.hasOwnProperty("deleted");t.isOpenChannel()?b.getChannel(t.channelUrl,function(r,i){if(R){var l=r;r=i,i=l}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);for(var u in ae.getInstance().channelHandlers){var c=ae.getInstance().channelHandlers[u];t.category===H.CATEGORY_CHANNEL_META_DATA_CHANGED?(a&&c.onMetaDataCreated(r,t.data.created),s&&c.onMetaDataUpdated(r,t.data.updated),o&&c.onMetaDataDeleted(r,t.data.deleted)):(a&&c.onMetaCountersCreated(r,t.data.created),s&&c.onMetaCountersUpdated(r,t.data.updated),o&&c.onMetaCountersDeleted(r,t.data.deleted))}}):w.getChannel(t.channelUrl,function(r,i){if(R){var l=r;r=i,i=l}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);for(var u in ae.getInstance().channelHandlers){var c=ae.getInstance().channelHandlers[u];t.category===H.CATEGORY_CHANNEL_META_DATA_CHANGED?(a&&c.onMetaDataCreated(r,t.data.created),s&&c.onMetaDataUpdated(r,t.data.updated),o&&c.onMetaDataDeleted(r,t.data.deleted)):(a&&c.onMetaCountersCreated(r,t.data.created),s&&c.onMetaCountersUpdated(r,t.data.updated),o&&c.onMetaCountersDeleted(r,t.data.deleted))}});break;case H.CATEGORY_CHANNEL_HIDE:w.getChannel(t.channelUrl,function(r,i){if(R){var a=r;r=i,i=a}if(i)return void n.log("Discard a command: "+e.command+":"+t.category);if(r.isHidden=!0,t.data&&t.data.hasOwnProperty("hide_previous_messages")&&t.data.hide_previous_messages&&w.cachedChannels){var s=w.cachedChannels[r.url];s.unreadMessageCount=0,w.cachedChannels[r.url]=s}for(var o in ae.getInstance().channelHandlers){ae.getInstance().channelHandlers[o].onChannelHidden(r)}})}};this.setPushTemplate=function(e,n){return!e||e!==this.PUSH_TEMPLATE_DEFAULT&&e!==this.PUSH_TEMPLATE_ALTERNATIVE?void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n):this.currentUser?void X.getInstance().setPushTemplate(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);var r=e.name.toString();U(r,null,n)}):void U(null,new _("Connection must be made before you set push template",j.CONNECTION_REQUIRED),n)},this.getPushTemplate=function(e){if(!this.currentUser)return void U(null,new _("Connection must be made before you get push template",j.CONNECTION_REQUIRED),e);X.getInstance().getPushTemplate(this.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);var r=n.name.toString();U(r,null,e)})},this.setChannelInvitationPreference=function(e,n){"boolean"!=typeof e&&U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n),X.getInstance().setChannelInvitationPreference(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U({autoAccept:e.auto_accept},null,n)})},this.getChannelInvitationPreference=function(e){X.getInstance().getChannelInvitationPreference(this.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);U({autoAccept:n.auto_accept},null,e)})},this.connect=function(){var e=Array.prototype.slice.call(arguments),r=null,i=null,a=null;switch("function"==typeof e.slice(-1)[0]&&(a=e.pop()),e.length){case 1:r=e[0];break;case 2:r=e[0],i=e[1];break;case 3:r=e[0],this.customApiHost=e[1],this.customWsHost=e[2];break;case 4:r=e[0],i=e[1],this.customApiHost=e[2],this.customWsHost=e[3];break;default:t&&n.log("sb.connect args length error: ",arguments)}r&&0!==r.length?(ae.getInstance().reconnectTimer&&(clearTimeout(ae.getInstance().reconnectTimer),ae.getInstance().reconnectTimer=null,ae.getInstance().onReconnectTimerCancel=null),ae.getInstance().getConnectionState()===this.connectionState.OPEN&&ae.getInstance().getCurrentUserId()===r?U(ae.getInstance().currentUser,null,a):(ae.getInstance().connectionCallback.push(a),1===ae.getInstance().connectionCallback.length&&(f(!0,null),g(r,i)))):U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),a)};var h=!1,I=!1,E=!0;this.setBackgroundState=function(){!h&&E&&(h=!0,this.getConnectionState()!==this.connectionState.CLOSED?(I=!0,f(!1,null)):I=!1)},this.setForegroundState=function(){h&&E&&(h=!1,I&&this.currentUser&&(y=0,A(this.getCurrentUserId(),!0)))},this.disableStateChange=function(){E=!1},this.enableStateChange=function(){E=!0},this.disconnect=function(e){f(!0,e)},this.reconnect=function(){if(!X.getInstance().sessionKey||!this.currentUser)return!1;var e=!0;return y>0&&(e=!1),f(!1,null),y=0,A(this.getCurrentUserId(),e),!0};var f=function(e,n){var t=this;ae.getInstance().loginTimer&&(clearTimeout(ae.getInstance().loginTimer),ae.getInstance().onLoginTimerCancel&&(ae.getInstance().onLoginTimerCancel(),ae.getInstance().onLoginTimerCancel=null),ae.getInstance().loginTimer=null),ae.getInstance().reconnectTimer&&(clearTimeout(ae.getInstance().reconnectTimer),ae.getInstance().onReconnectTimerCancel&&(ae.getInstance().onReconnectTimerCancel(),ae.getInstance().onReconnectTimerCancel=null),ae.getInstance().reconnectTimer=null),ae.getInstance().wsClient&&(y=0,ae.getInstance().wsClient.disconnect(!0),ae.getInstance().wsClient=null),function(){if(e){b.clearEnteredChannels(),b.clearCache(),w.clearCache(),ae.getInstance().globalTimer&&(clearTimeout(t.globalTimer),ae.getInstance().globalTimer=null);for(var r in ae.getInstance().ackStateMap)clearTimeout(ae.getInstance().ackStateMap[r].timer);ae.getInstance().ackStateMap={},ae.getInstance().currentUser=null,X.getInstance().sessionKey=null,X.getInstance().ekey=null}U(null,null,n)}()},A=function(e,r){if(ae.getInstance().reconnectTimer)t&&n.log("still reconnecting");else{if((y+=1)<=1){if(r)for(var i in ae.getInstance().connectionHandlers){var a=ae.getInstance().connectionHandlers[i];a.onReconnectStarted(i)}P=0}else P=3e3*Math.pow(2,y-2);if(!e||!X.getInstance().sessionKey||y>=6){f(!1,null),y=0;for(var i in ae.getInstance().connectionHandlers){var a=ae.getInstance().connectionHandlers[i];a.onReconnectFailed(i)}return}ae.getInstance().onReconnectTimerCancel=function(){y=0},ae.getInstance().reconnectTimer=setTimeout(function(){ae.getInstance().reconnectTimer=null,ae.getInstance().onReconnectTimerCancel=null,ae.getInstance().wsClient&&ae.getInstance().wsClient.disconnect(!0);var r=new Z.WSClientHandler;ae.getInstance().wsClient=new Z(r),ae.getInstance().loginHandler=function(e){y=0;for(var n in b.enteredChannels){b.enteredChannels[n].enter()}for(var n in ae.getInstance().connectionHandlers){ae.getInstance().connectionHandlers[n].onReconnectSucceeded(n)}},r.onOpen=function(){t&&n.log("reconnectWS onOpen"),ae.getInstance().loginTimer=setTimeout(function(){t&&n.log("reconnectWS loginTimer timedout"),ae.getInstance().loginTimer=null,A(e,!0)},1e4),ae.getInstance().onLoginTimerCancel=null},r.onMessage=function(e){l(e)},r.onError=function(){t&&n.log("reconnectWS onError"),A(e,!0)},r.onClose=function(){t&&n.log("reconnectWS onClose")};var i=ae.getInstance().getCurrentApiHost();X.getInstance().checkRouting(function(n,t){if(t)return void A(e,!0);i!==n.API_HOST&&C(n.API_HOST,{},"GET",{},function(){}),ae.getInstance().wsClient.connect(e,null,n.WS_HOST)})},P)}},g=function(e,r){var i=new Z.WSClientHandler;ae.getInstance().wsClient=new Z(i),i.onMessage=function(e){l(e)},ae.getInstance().loginHandler=function(e,n){if(n)ae.getInstance().disconnect(null),ae.getInstance().connectionCallback.forEach(function(e){U(null,n,e)}),ae.getInstance().connectionCallback=[];else{clearTimeout(ae.getInstance().globalTimer);var t=function(){if(w.cachedChannels)for(var e in w.cachedChannels){var n=w.cachedChannels[e];if(n.invalidateTypingStatus())for(var r in ae.getInstance().channelHandlers){var i=ae.getInstance().channelHandlers[r];i.onTypingStatusUpdated(n)}}ae.getInstance().globalTimer=setTimeout(function(){t()},1e3)};t();var r=ae.getInstance().connectionCallback;ae.getInstance().connectionCallback=[],r.forEach(function(n){U(e,null,n)}),r=[]}},i.onOpen=function(e){ae.getInstance().loginTimer=setTimeout(function(){ae.getInstance().loginTimer=null,ae.getInstance().onLoginTimerCancel=null,ae.getInstance().disconnect(null),ae.getInstance().connectionCallback.forEach(function(e){U(null,new _("Connection timeout.",j.LOGIN_TIMEOUT),e)}),ae.getInstance().connectionCallback=[]},1e4),ae.getInstance().onLoginTimerCancel=function(){ae.getInstance().connectionCallback.forEach(function(e){U(null,new _("Connection Cancelled.",j.REQUEST_FAILED),e)}),ae.getInstance().connectionCallback=[]}},i.onError=function(r){t&&n.log("WSClientHandler.onError",r),X.getInstance().sessionKey?A(e,!0):(ae.getInstance().connectionCallback.forEach(function(e){U(null,new _("Websocket connection failed.",j.WEBSOCKET_CONNECTION_FAILED),e)}),ae.getInstance().connectionCallback=[])},i.onClose=function(e){t&&n.log("WSClientHandler.onClose")},X.getInstance().checkRouting(function(n,t){if(t)return ae.getInstance().connectionCallback.forEach(function(e){U(null,new _("Connection routing failed.",j.REQUEST_FAILED),e)}),void(ae.getInstance().connectionCallback=[]);C(n.API_HOST,{},"GET",{},function(){}),ae.getInstance().wsClient.connect(e,r,n.WS_HOST)})};this.sendCommand=function(e,n){if(!ae.getInstance().hasLoggedIn())return void(n&&n(null,new _("Connection should be made first.",j.CONNECTION_REQUIRED)));if(null==ae.getInstance().wsClient||ae.getInstance().wsClient.getConnectionState()!==ae.getInstance().connectionState.OPEN)return void(n&&n(null,new _("Connection is not valid. Please reconnect.",j.WEBSOCKET_CONNECTION_CLOSED)));if(e.isAckRequired()){var t=e.requestId,r={handler:n,timer:setTimeout(function(){n(null,new _("Command received no ack.",j.ACK_TIMEOUT)),delete s[t]},1e4)};s[t]=r,ae.getInstance().wsClient.send(e,function(e,t){if(t)return clearTimeout(r.timer),void n(null,t)})}else ae.getInstance().wsClient.send(e,n)},this.markAsReadAll=function(e){var n=(new Date).getTime();if(n-w.markAsReadAllLastSentAt<1e3)return void U(null,new _("MarkAsRead rate limit exceeded.",j.MARK_AS_READ_RATE_LIMIT_EXCEEDED),e);w.markAsReadAllLastSentAt=n,X.getInstance().groupChannelMarkAsReadAll(ae.getInstance().getCurrentUserId(),null,function(n,t){if(t)return void U(null,t,e);for(var r in w.cachedChannels)w.cachedChannels[r].unreadMessageCount=0;U(null,null,e)})},this.markAsReadWithChannelUrls=function(e,n){if(!Array.isArray(e))return void U(null,new _("Invalid parameter.",j.INVALID_PARAMETER),n);var t=(new Date).getTime();if(t-w.markAsReadAllLastSentAt<1e3)return void U(null,new _("MarkAsRead rate limit exceeded.",j.MARK_AS_READ_RATE_LIMIT_EXCEEDED),n);w.markAsReadAllLastSentAt=t,X.getInstance().groupChannelMarkAsReadAll(ae.getInstance().getCurrentUserId(),e,function(t,r){if(r)return void U(null,r,n);e.forEach(function(e){var n=w.cachedChannels[e];n&&(n.unreadMessageCount=0,w.cachedChannels[e]=n)}),U(null,null,n)})},this.updateCurrentUserInfoWithProfileImage=function(e,n,t){var r=this;n?X.getInstance().updateCurrentUserInfoWithFile(r.getCurrentUserId(),e,n,function(i,a){if(a)return void U(null,a,t);r.currentUser&&(e&&(r.currentUser.nickname=e),n&&(r.currentUser.profileUrl=i.profile_url)),U(r.currentUser,null,t)}):r.updateCurrentUserInfo(e,null,t)},this.updateCurrentUserInfo=function(e,n,t){var r=this;X.getInstance().updateUserInfo(r.getCurrentUserId(),e,n,function(i,a){if(a)return void U(null,a,t);r.currentUser&&(e&&(r.currentUser.nickname=e),n&&(r.currentUser.profileUrl=n)),U(r.currentUser,null,t)})},this.getPendingGCMToken=function(){return this.GCMPushToken},this.getPendingAPNSToken=function(){return this.APNSPushToken},this.registerGCMPushTokenForCurrentUser=function(e,n){var t=this;return e?this.currentUser?void X.getInstance().registerGCMPushToken(this.getCurrentUserId(),e,function(e,r){if(r)return void U(t.pushTokenRegistrationState.ERROR,r,n);t.GCMPushToken="",U(t.pushTokenRegistrationState.SUCCESS,null,n)}):(t.GCMPushToken=e,void U(t.pushTokenRegistrationState.PENDING,null,n)):void U(t.pushTokenRegistrationState.ERROR,new _("Invalid token",j.INVALID_PARAMETER),n)},this.unregisterGCMPushTokenForCurrentUser=function(e,n){if(!e)return void U(null,new _("Invalid token",j.INVALID_PARAMETER),n);X.getInstance().unregisterGCMPushToken(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.unregisterGCMPushTokenAllForCurrentUser=function(e){X.getInstance().unregisterGCMPushTokenAll(this.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);U(null,null,e)})},this.registerAPNSPushTokenForCurrentUser=function(e,n){var t=this;return e?this.currentUser?void X.getInstance().registerAPNSPushToken(this.getCurrentUserId(),e,function(e,r){if(r)return void U(t.pushTokenRegistrationState.ERROR,r,n);t.APNSPushToken="",U(t.pushTokenRegistrationState.SUCCESS,null,n)}):(t.APNSPushToken=e,void U(t.pushTokenRegistrationState.PENDING,null,n)):void U(t.pushTokenRegistrationState.ERROR,new _("Invalid token",j.INVALID_PARAMETER),n)},this.unregisterAPNSPushTokenForCurrentUser=function(e,n){if(!e)return void U(null,new _("Invalid token",j.INVALID_PARAMETER),n);X.getInstance().unregisterAPNSPushToken(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.unregisterAPNSPushTokenAllForCurrentUser=function(e){X.getInstance().unregisterAPNSPushTokenAll(this.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);U(null,null,e)})},this.unregisterPushTokenAllForCurrentUser=function(e){X.getInstance().unregisterAPNSPushTokenAll(this.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);U(null,null,e)})},this.setDoNotDisturb=function(e,n,t,r,i,a,s){var o=this;if(n<0||n>23||t<0||t>59||r<0||r>23||i<0||i>59)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),s);X.getInstance().setDoNotDisturb(o.getCurrentUserId(),e,n,t,r,i,a,function(e,n){if(n)return void U(null,n,s);var t={doNotDisturbOn:e.do_not_disturb,startHour:e.start_hour,startMin:e.start_min,endHour:e.end_hour,endMin:e.end_min,timezone:e.timezone};U(t,null,s)})},this.getDoNotDisturb=function(e){var n=this;X.getInstance().getDoNotDisturb(n.getCurrentUserId(),function(n,t){if(t)return void U(null,t,e);var r={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone};U(r,null,e)})},this.blockUser=function(e,n){if("object"!=typeof e)return void U(null,new _("You have to pass user object.",j.INVALID_PARAMETER),n);this.blockUserWithUserId(e.userId,n)},this.blockUserWithUserId=function(e,n){if(this.getCurrentUserId()===e)return void U(null,new _("You can not block yourself.",j.INVALID_PARAMETER),n);X.getInstance().blockUser(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(new G(e),null,n)})},this.unblockUser=function(e,n){if("object"!=typeof e)return void U(null,new _("You have to pass user object.",j.INVALID_PARAMETER),n);this.unblockUserWithUserId(e.userId,n)},this.unblockUserWithUserId=function(e,n){if(this.getCurrentUserId()===e)return void U(null,new _("You can not unblock yourself.",j.INVALID_PARAMETER),n);X.getInstance().unblockUser(this.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(null,null,n)})},this.addFriends=function(e,n){if(!Array.isArray(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);var t=this;X.getInstance().addFriends(t.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);var r=e.users.map(function(e){return new G(e)});U(r,null,n)})},this.deleteFriends=function(e,n){if(!Array.isArray(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);var t=this;X.getInstance().deleteFriends(t.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)})},this.deleteFriend=function(e,n){if("string"!=typeof e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);this.deleteFriends([e],n)},this.uploadFriendDiscoveries=function(e,n){var t=!0;for(var r in e)if(!e[r].hasOwnProperty("friendDiscoveryKey")){t=!1,U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);break}if(t){var i=this;X.getInstance().uploadFriendDiscoveries(i.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)})}},this.deleteFriendDiscoveries=function(e,n){if(!Array.isArray(e))return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);var t=this;X.getInstance().deleteFriendDiscoveries(t.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);U(e,null,n)})},this.deleteFriendDiscovery=function(e,n){if("string"!=typeof e)return void U(null,new _("Invalid arguments.",j.INVALID_PARAMETER),n);this.deleteFriendDiscoveries([e],n)},this.getFriendChangeLogsByToken=function(e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n)return null;var t=this;X.getInstance().getFriendChangeLogsByToken(t.getCurrentUserId(),e,function(e,t){if(t)return void U(null,t,n);var r=e.updated.map(function(e){return new G(G.build(e.user_id,e.nickname,e.profile_url,e.is_online,e.last_seen_at,e.metadata,e.is_active,e.friend_discovery_key,e.friend_name))}),i=e.deleted,a=e.has_more,s=e.next;U({updatedUsers:r,deletedUserIds:i,hasMore:a,token:s},null,n)})},this.createFriendListQuery=function(){return new ee}},se=null;return ae.getInstance=function(){return null===se?null:se},{SendBird:ae}},g=null;return function(){var e=function(e){if(e.newInstance||!g){var n=new A;g=new n.SendBird(e)}else if(g&&e.appId!==g.getApplicationId()&&g.getConnectionState()===g.connectionState.CLOSED){var n=new A;g=new n.SendBird(e)}return g};return e.getInstance=function(){return null===g?null:g},e.version="3.0.60",{SendBird:e}}().SendBird});